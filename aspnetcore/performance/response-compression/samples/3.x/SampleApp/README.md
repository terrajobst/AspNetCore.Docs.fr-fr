# <a name="response-compression-sample-application-aspnet-core-3x"></a><span data-ttu-id="99330-101">Exemple d’application de compression de réponse (ASP.NET Core 3. x)</span><span class="sxs-lookup"><span data-stu-id="99330-101">Response compression sample application (ASP.NET Core 3.x)</span></span>

<span data-ttu-id="99330-102">Cet exemple illustre l’utilisation de l’intergiciel (middleware) de compression des réponses ASP.NET Core 3. x pour compresser les réponses HTTP.</span><span class="sxs-lookup"><span data-stu-id="99330-102">This sample illustrates the use of ASP.NET Core 3.x Response Compression Middleware to compress HTTP responses.</span></span> <span data-ttu-id="99330-103">L’exemple illustre les fournisseurs de compression gzip, Brotli et personnalisées pour les réponses de texte et d’image et montre comment ajouter un type MIME pour la compression.</span><span class="sxs-lookup"><span data-stu-id="99330-103">The sample demonstrates Gzip, Brotli, and custom compression providers for text and image responses and shows how to add a MIME type for compression.</span></span> <span data-ttu-id="99330-104">Pour obtenir l’exemple ASP.NET Core 2. x, consultez [exemple d’application de compression de réponse (ASP.net Core 2. x)](https://github.com/aspnet/AspNetCore.Docs/tree/master/aspnetcore/performance/response-compression/samples/2.x).</span><span class="sxs-lookup"><span data-stu-id="99330-104">For the ASP.NET Core 2.x sample, see [Response compression sample application (ASP.NET Core 2.x)](https://github.com/aspnet/AspNetCore.Docs/tree/master/aspnetcore/performance/response-compression/samples/2.x).</span></span>

## <a name="examples-in-this-sample"></a><span data-ttu-id="99330-105">Extraits de cet exemple</span><span class="sxs-lookup"><span data-stu-id="99330-105">Examples in this sample</span></span>

* `BrotliCompressionProvider`
  * `text/plain`
    * <span data-ttu-id="99330-106">**/** -La réponse du fichier texte Lorem ipsum à 2 044 octets qui compressent jusqu’à ~ 979 octets.</span><span class="sxs-lookup"><span data-stu-id="99330-106">**/** - Lorem Ipsum text file response at 2,044 bytes that compresses to ~979 bytes.</span></span>
    * <span data-ttu-id="99330-107">**/testfile1kb.txt** : réponse du fichier texte à 1 033 octets qui compresse jusqu’à ~ 36 octets.</span><span class="sxs-lookup"><span data-stu-id="99330-107">**/testfile1kb.txt** - Text file response at 1,033 bytes that compresses to ~36 bytes.</span></span>
    * <span data-ttu-id="99330-108">**/Trickle** -réponse émise sous forme de caractères uniques à des intervalles de 1 seconde.</span><span class="sxs-lookup"><span data-stu-id="99330-108">**/trickle** - Response issued as single characters at 1 second intervals.</span></span>
* `GzipCompressionProvider`
  * `text/plain`
    * <span data-ttu-id="99330-109">**/** -La réponse du fichier texte Lorem ipsum à 2 044 octets qui compressent jusqu’à ~ 927 octets.</span><span class="sxs-lookup"><span data-stu-id="99330-109">**/** - Lorem Ipsum text file response at 2,044 bytes that compresses to ~927 bytes.</span></span>
    * <span data-ttu-id="99330-110">**/testfile1kb.txt** : réponse du fichier texte à 1 033 octets qui compresse jusqu’à ~ 47 octets.</span><span class="sxs-lookup"><span data-stu-id="99330-110">**/testfile1kb.txt** - Text file response at 1,033 bytes that compresses to ~47 bytes.</span></span>
    * <span data-ttu-id="99330-111">**/Trickle** -réponse émise sous forme de caractères uniques à des intervalles de 1 seconde.</span><span class="sxs-lookup"><span data-stu-id="99330-111">**/trickle** - Response issued as single characters at 1 second intervals.</span></span>
  * `image/svg+xml`
    * <span data-ttu-id="99330-112">**/Banner.svg** : réponse d’image SVG (Scalable Vector Graphics) à 9 707 octets qui compresse jusqu’à ~ 4 459 octets.</span><span class="sxs-lookup"><span data-stu-id="99330-112">**/banner.svg** - A Scalable Vector Graphics (SVG) image response at 9,707 bytes that compresses to ~4,459 bytes.</span></span>
* `CustomCompressionProvider`<br><span data-ttu-id="99330-113">Montre comment implémenter un fournisseur de compression personnalisé à utiliser avec l’intergiciel (middleware).</span><span class="sxs-lookup"><span data-stu-id="99330-113">Shows how to implement a custom compression provider for use with the middleware.</span></span>

<span data-ttu-id="99330-114">Lorsque la requête inclut l' `Accept-Encoding` en-tête et que la compression de la réponse est réussie, `Vary: Accept-Encoding` l’intergiciel ajoute automatiquement un en-tête à la réponse.</span><span class="sxs-lookup"><span data-stu-id="99330-114">When the request includes the `Accept-Encoding` header and response compression is successful, the middleware automatically adds a `Vary: Accept-Encoding` header to the response.</span></span> <span data-ttu-id="99330-115">L' `Vary` en-tête indique aux caches de conserver plusieurs copies de la réponse en fonction des `Accept-Encoding`autres valeurs de, de sorte qu’une version compressée (gzip ou Brotli) et une version non compressée sont stockées dans des caches pour les systèmes qui peuvent accepter le la réponse est compressée ou non compressée.</span><span class="sxs-lookup"><span data-stu-id="99330-115">The `Vary` header instructs caches to maintain multiple copies of the response based on alternative values of `Accept-Encoding`, so both a compressed (Gzip or Brotli) and uncompressed version are stored in caches for systems that can either accept the compressed or the uncompressed response.</span></span>

## <a name="use-the-sample"></a><span data-ttu-id="99330-116">Utiliser l’exemple</span><span class="sxs-lookup"><span data-stu-id="99330-116">Use the sample</span></span>

1. <span data-ttu-id="99330-117">Effectuez une demande à l’aide de [Fiddler](https://www.telerik.com/fiddler), [Firebug](https://getfirebug.com/)ou du [billet](https://www.getpostman.com/) `Accept-Encoding` à l’application sans en-tête et notez la charge utile de réponse, la taille de la réponse et les en-têtes de réponse.</span><span class="sxs-lookup"><span data-stu-id="99330-117">Make a request using [Fiddler](https://www.telerik.com/fiddler), [Firebug](https://getfirebug.com/), or [Postman](https://www.getpostman.com/) to the application without an `Accept-Encoding` header and note the response payload, response size, and response headers.</span></span>
1. <span data-ttu-id="99330-118">Ajoutez un `Accept-Encoding: br` en `Accept-Encoding: gzip` -tête ou et notez la taille de réponse compressée et les en-têtes de réponse.</span><span class="sxs-lookup"><span data-stu-id="99330-118">Add an `Accept-Encoding: br` or `Accept-Encoding: gzip` header and note the compressed response size and response headers.</span></span> <span data-ttu-id="99330-119">La taille de la réponse est abandonnée et l' `Content-Encoding` en-tête de réponse est inclus par l’intergiciel (middleware) indiquant que la compression avec gzip ou Brotli s’est produite.</span><span class="sxs-lookup"><span data-stu-id="99330-119">The response size drops, and the `Content-Encoding` response header is included by the middleware indicating that compression with either Gzip or Brotli occurred.</span></span> <span data-ttu-id="99330-120">Lorsque vous examinez le corps de la réponse pour la réponse Lorem ipsum ou **testfile1kb. txt** , vous constatez que le texte est compressé et illisible.</span><span class="sxs-lookup"><span data-stu-id="99330-120">When you look at the response body for the Lorem Ipsum or **testfile1kb.txt** response, you see that the text is compressed and unreadable.</span></span>
1. <span data-ttu-id="99330-121">Ajoutez un `Accept-Encoding: mycustomcompression` en-tête et notez les en-têtes de réponse.</span><span class="sxs-lookup"><span data-stu-id="99330-121">Add an `Accept-Encoding: mycustomcompression` header and note the response headers.</span></span> <span data-ttu-id="99330-122">Est une implémentation vide qui ne compresse pas réellement la réponse, mais vous pouvez créer un wrapper de flux de compression personnalisé `CreateStream()` pour la méthode. `CustomCompressionProvider`</span><span class="sxs-lookup"><span data-stu-id="99330-122">The `CustomCompressionProvider` is an empty implementation that doesn't actually compress the response, but you can create a custom compression stream wrapper for the `CreateStream()` method.</span></span>
