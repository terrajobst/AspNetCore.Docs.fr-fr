---
uid: identity/overview/getting-started/developing-aspnet-apps-with-windows-azure-active-directory
title: "Développement d’applications ASP.NET avec Azure Active Directory | Documents Microsoft"
author: Rick-Anderson
description: "Outils Microsoft ASP.NET pour Azure Active Directory facilite activer l’authentification pour les applications web hébergées sur Azure. Vous pouvez utiliser Azure Authenti..."
ms.author: aspnetcontent
manager: wpickett
ms.date: 08/14/2014
ms.topic: article
ms.assetid: 457d7eaf-ee76-4ceb-9082-c7c1721435ad
ms.technology: 
ms.prod: .net-framework
msc.legacyurl: /identity/overview/getting-started/developing-aspnet-apps-with-windows-azure-active-directory
msc.type: authoredcontent
ms.openlocfilehash: 425f8edff41588db363055d166995d5f563c5a23
ms.sourcegitcommit: 9a9483aceb34591c97451997036a9120c3fe2baf
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 11/10/2017
---
<a name="developing-aspnet-apps-with-azure-active-directory"></a><span data-ttu-id="a36db-104">Développement d’applications ASP.NET avec Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="a36db-104">Developing ASP.NET Apps with Azure Active Directory</span></span>
====================
<span data-ttu-id="a36db-105">Par [Rick Anderson](https://github.com/Rick-Anderson)</span><span class="sxs-lookup"><span data-stu-id="a36db-105">by [Rick Anderson](https://github.com/Rick-Anderson)</span></span>

> <span data-ttu-id="a36db-106">Des outils Microsoft ASP.NET pour Azure Active Directory facilite l’activer l’authentification pour les applications web hébergées sur [Azure](https://www.windowsazure.com/en-us/home/features/web-sites/).</span><span class="sxs-lookup"><span data-stu-id="a36db-106">Microsoft ASP.NET tools for Azure Active Directory makes it simple to enable authentication for web applications hosted on [Azure](https://www.windowsazure.com/en-us/home/features/web-sites/).</span></span> <span data-ttu-id="a36db-107">Vous pouvez utiliser l’authentification Azure pour authentifier les utilisateurs d’Office 365 à partir de votre organisation, les comptes d’entreprise synchronisés à partir de votre annuaire Active Directory sur site ou les utilisateurs créés dans votre domaine Azure Active Directory personnalisé.</span><span class="sxs-lookup"><span data-stu-id="a36db-107">You can use Azure Authentication to authenticate Office 365 users from your organization, corporate accounts synced from your on-premise Active Directory or users created in your own custom Azure Active Directory domain.</span></span> <span data-ttu-id="a36db-108">Activer l’authentification de Windows Azure configure votre application pour authentifier les utilisateurs à l’aide d’un seul [Azure Active Directory](https://docs.microsoft.com/azure/active-directory/) client.</span><span class="sxs-lookup"><span data-stu-id="a36db-108">Enabling Windows Azure Authentication configures your application to authenticate users using a single [Azure Active Directory](https://docs.microsoft.com/azure/active-directory/) tenant.</span></span>
> 
>  <span data-ttu-id="a36db-109">Ce didacticiel a été rédigé par Rick Anderson[@RickAndMSFT](https://twitter.com/#!/RickAndMSFT)</span><span class="sxs-lookup"><span data-stu-id="a36db-109">This tutorial was written by Rick Anderson [@RickAndMSFT](https://twitter.com/#!/RickAndMSFT)</span></span>


<span data-ttu-id="a36db-110">Ce didacticiel va vous montrer comment créer une application ASP.NET qui est configurée pour l’authentification avec [Azure Active Directory](https://msdn.microsoft.com/en-us/library/azure/mt168838.aspx) (Azure AD).</span><span class="sxs-lookup"><span data-stu-id="a36db-110">This tutorial will show you how to create an ASP.NET application that is configured for sign-on with [Azure Active Directory](https://msdn.microsoft.com/en-us/library/azure/mt168838.aspx) (Azure AD).</span></span> <span data-ttu-id="a36db-111">Vous apprendrez également comment appeler l’API Graph pour obtenir des informations sur l’utilisateur actuellement connecté et le déploiement de l’application sur Azure.</span><span class="sxs-lookup"><span data-stu-id="a36db-111">You will also learn how to call the Graph API to get information about the currently signed-in user and how to deploy the application to Azure.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="a36db-112">Conditions préalables</span><span class="sxs-lookup"><span data-stu-id="a36db-112">Prerequisites</span></span>

1. <span data-ttu-id="a36db-113">[Visual Studio Express 2013 pour le Web](https://www.microsoft.com/visualstudio/eng/2013-downloads#d-2013-express) ou [Visual Studio 2013](https://www.microsoft.com/visualstudio/eng/2013-downloads).</span><span class="sxs-lookup"><span data-stu-id="a36db-113">[Visual Studio Express 2013 for Web](https://www.microsoft.com/visualstudio/eng/2013-downloads#d-2013-express) or [Visual Studio 2013](https://www.microsoft.com/visualstudio/eng/2013-downloads).</span></span>
2. <span data-ttu-id="a36db-114">[Visual Studio 2013 Update 4](https://www.microsoft.com/en-us/download/details.aspx?id=44921) -mise à jour 3 ou version ultérieure est requis.</span><span class="sxs-lookup"><span data-stu-id="a36db-114">[Visual Studio 2013 Update 4](https://www.microsoft.com/en-us/download/details.aspx?id=44921) - Update 3 or higher is required.</span></span>
3. <span data-ttu-id="a36db-115">Un compte Azure.</span><span class="sxs-lookup"><span data-stu-id="a36db-115">An Azure account.</span></span> <span data-ttu-id="a36db-116">[Cliquez ici](https://azure.microsoft.com/en-us/pricing/free-trial/) pour un essai gratuit si vous n’avez pas déjà un compte.</span><span class="sxs-lookup"><span data-stu-id="a36db-116">[Click here](https://azure.microsoft.com/en-us/pricing/free-trial/) for a free trial if you do not already have an account.</span></span>

## <a name="add-a-global-administrator-to-your-active-directory"></a><span data-ttu-id="a36db-117">Ajouter un administrateur Global pour votre annuaire Active Directory</span><span class="sxs-lookup"><span data-stu-id="a36db-117">Add a Global Administrator to your Active Directory</span></span>

1. <span data-ttu-id="a36db-118">Se connecter à la [portail de gestion Azure](https://manage.windowsazure.com/).</span><span class="sxs-lookup"><span data-stu-id="a36db-118">Sign in to the [Azure Management Portal](https://manage.windowsazure.com/).</span></span>
2. <span data-ttu-id="a36db-119">Tous les comptes Azure contiennent un **répertoire par défaut** --cliquez dessus, puis cliquez sur le **utilisateurs** onglet en haut de la page (voir l’image ci-dessous).</span><span class="sxs-lookup"><span data-stu-id="a36db-119">All Azure accounts contain a **Default Directory** -- click on it, then click the **Users** tab at the top of the page (see image below).</span></span>
3. <span data-ttu-id="a36db-120">Cliquez sur Ajouter un utilisateur.</span><span class="sxs-lookup"><span data-stu-id="a36db-120">Click Add User.</span></span>  
    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image1.png)
4. <span data-ttu-id="a36db-121">Créer un nouvel utilisateur avec le **administrateur Global** rôle.</span><span class="sxs-lookup"><span data-stu-id="a36db-121">Create a new user with the **Global Administrator** role.</span></span> <span data-ttu-id="a36db-122">Cliquez sur **utilisateurs** dans le menu supérieur, puis cliquez sur le **ajouter un utilisateur** bouton sur la barre de commandes.</span><span class="sxs-lookup"><span data-stu-id="a36db-122">Click **Users** from the top menu, and then click the **Add User** button on the command bar.</span></span>
5. <span data-ttu-id="a36db-123">Dans le **ajouter un utilisateur** boîte de dialogue, entrez un nom pour le nouvel utilisateur, puis cliquez sur la flèche droite.</span><span class="sxs-lookup"><span data-stu-id="a36db-123">In the **Add User** dialog, enter a name for the new user and then click the right arrow.</span></span>  
  
    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image2.png)
6. <span data-ttu-id="a36db-124">Entrez le nom d’utilisateur et le rôle de la valeur **administrateur Global**.</span><span class="sxs-lookup"><span data-stu-id="a36db-124">Enter the user name and set the role to **Global Administrator**.</span></span> <span data-ttu-id="a36db-125">Les administrateurs globaux requièrent une adresse de messagerie pour à des fins de récupération de mot de passe.</span><span class="sxs-lookup"><span data-stu-id="a36db-125">Global administrators require an alternate email address for password recovery purposes.</span></span> <span data-ttu-id="a36db-126">Une fois que vous avez terminé, cliquez sur la flèche droite.</span><span class="sxs-lookup"><span data-stu-id="a36db-126">After you're finished, click the right arrow.</span></span>  
  
    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image3.png)
7. <span data-ttu-id="a36db-127">Dans la page suivante de la boîte de dialogue, cliquez sur **créer**.</span><span class="sxs-lookup"><span data-stu-id="a36db-127">On the next page of the dialog, click **Create**.</span></span> <span data-ttu-id="a36db-128">Un mot de passe temporaire sera créé pour le nouvel utilisateur et affiché dans la boîte de dialogue.</span><span class="sxs-lookup"><span data-stu-id="a36db-128">A temporary password will be created for the new user and displayed in the dialog.</span></span>   
  
    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image4.png)  
  
 <span data-ttu-id="a36db-129">Enregistrer le mot de passe, vous serez requis pour modifier le mot de passe après la première connexion.</span><span class="sxs-lookup"><span data-stu-id="a36db-129">Save the password, you will be required to change the password after the first log in.</span></span> <span data-ttu-id="a36db-130">L’illustration suivante montre le nouveau compte d’administrateur.</span><span class="sxs-lookup"><span data-stu-id="a36db-130">The following image shows the new admin account.</span></span> <span data-ttu-id="a36db-131">Vous devez utiliser Azure Active Directory pour vous connecter à votre application, et non le compte Microsoft également affiché sur cette page.</span><span class="sxs-lookup"><span data-stu-id="a36db-131">You must use the Azure Active Directory to log into your app, not the Microsoft account also shown on this page.</span></span>  
  
    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image5.png)

## <a name="create-an-aspnet-application"></a><span data-ttu-id="a36db-132">Créer une Application ASP.NET</span><span class="sxs-lookup"><span data-stu-id="a36db-132">Create an ASP.NET Application</span></span>

<span data-ttu-id="a36db-133">Les étapes suivantes utilisent [Visual Studio Express 2013 pour le Web](https://www.microsoft.com/en-us/download/details.aspx?id=40747)et nécessite [Visual Studio 2013 Update 3](https://www.microsoft.com/en-us/download/details.aspx?id=43721).</span><span class="sxs-lookup"><span data-stu-id="a36db-133">The following steps use [Visual Studio Express 2013 for Web](https://www.microsoft.com/en-us/download/details.aspx?id=40747), and requires [Visual Studio 2013 Update 3](https://www.microsoft.com/en-us/download/details.aspx?id=43721).</span></span>

1. <span data-ttu-id="a36db-134">Dans Visual Studio, cliquez sur **fichier** , puis **nouveau projet**.</span><span class="sxs-lookup"><span data-stu-id="a36db-134">In Visual Studio, click **File** and then **New Project**.</span></span> <span data-ttu-id="a36db-135">Sur le **nouveau projet** boîte de dialogue, sélectionnez Visual c# Web du projet dans le menu de gauche, cliquez sur **OK**.</span><span class="sxs-lookup"><span data-stu-id="a36db-135">On the **New Project** dialog, select the Visual C# Web project from the left menu and click **OK**.</span></span> <span data-ttu-id="a36db-136">Vous pouvez également désactiver le **ajouter Application Insights au projet** si vous ne souhaitez pas que les fonctionnalités de votre application.</span><span class="sxs-lookup"><span data-stu-id="a36db-136">You may also want to uncheck the **Add Application Insights to Project** if you don't want the functionality for your application.</span></span>
2. <span data-ttu-id="a36db-137">Dans le **nouveau projet ASP.NET** boîte de dialogue, sélectionnez **MVC**, puis cliquez sur **modifier l’authentification**.</span><span class="sxs-lookup"><span data-stu-id="a36db-137">In the **New ASP.NET Project** dialog, select **MVC**, and then click **Change Authentication**.</span></span>   
  
    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image6.png)
3. <span data-ttu-id="a36db-138">Sur le **modifier l’authentification** boîte de dialogue, sélectionnez **comptes professionnels**.</span><span class="sxs-lookup"><span data-stu-id="a36db-138">On the **Change Authentication** dialog, select **Organizational Accounts**.</span></span> <span data-ttu-id="a36db-139">Ces options peuvent être utilisées pour automatiquement enregistrer votre application auprès d’Azure AD ainsi que pour configurer automatiquement votre application à intégrer à Azure AD.</span><span class="sxs-lookup"><span data-stu-id="a36db-139">These options can be used to automatically register your application with Azure AD as well as automatically configure your application to integrate with Azure AD.</span></span> <span data-ttu-id="a36db-140">Vous n’êtes pas obligé d’utiliser le **modifier l’authentification** boîte de dialogue pour inscrire et configurer votre application, mais il rend plus facile.</span><span class="sxs-lookup"><span data-stu-id="a36db-140">You don't have to use the **Change Authentication** dialog to register and configure your application, but it makes it much easier.</span></span> <span data-ttu-id="a36db-141">Si vous utilisez Visual Studio 2012 par exemple, vous pouvez manuellement inscrire l’application dans le portail de gestion Azure et mettre à jour sa configuration à intégrer à Azure AD.</span><span class="sxs-lookup"><span data-stu-id="a36db-141">If you are using Visual Studio 2012 for example, you can still manually register the application in the Azure Management Portal and update its configuration to integrate with Azure AD.</span></span>  
 <span data-ttu-id="a36db-142">Dans les menus de la liste déroulante, sélectionnez **Cloud - organisation** et **Single Sign On, les données d’annuaire en lecture**.</span><span class="sxs-lookup"><span data-stu-id="a36db-142">In the drop-down menus, select **Cloud - Single Organization** and **Single Sign On, Read directory data**.</span></span> <span data-ttu-id="a36db-143">Entrez le domaine de votre annuaire Azure AD, par exemple (dans les images ci-dessous) *aricka0yahoo.onmicrosoft.com*, puis cliquez sur **OK**.</span><span class="sxs-lookup"><span data-stu-id="a36db-143">Enter the domain for your Azure AD directory, for example (in the images below) *aricka0yahoo.onmicrosoft.com*, and then click **OK**.</span></span> <span data-ttu-id="a36db-144">Vous pouvez obtenir le nom de domaine à partir de l’onglet domaines pour le répertoire par défaut sur le portail azure (voir l’image suivante vers le bas).</span><span class="sxs-lookup"><span data-stu-id="a36db-144">You can get the domain name from the Domains tab for the Default Directory on the azure portal (see the next image down).</span></span>   
  
    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image7.png)  
  
 <span data-ttu-id="a36db-145">L’illustration suivante montre le nom de domaine à partir du portail Azure.</span><span class="sxs-lookup"><span data-stu-id="a36db-145">The following image shows the domain name from the Azure portal.</span></span>  
  
    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image8.png)  

    > [!NOTE]
    > <span data-ttu-id="a36db-146">Vous pouvez éventuellement configurer l’URI ID d’Application qui sera inscrit dans Azure AD en cliquant sur **plus d’Options**.</span><span class="sxs-lookup"><span data-stu-id="a36db-146">You can optionally configure the Application ID URI that will be registered in Azure AD by clicking **More Options**.</span></span> <span data-ttu-id="a36db-147">L’URI ID d’application est l’identificateur unique pour une application, ce qui est inscrit dans Azure AD et utilisée par l’application pour s’identifier lors de la communication avec Azure AD.</span><span class="sxs-lookup"><span data-stu-id="a36db-147">The App ID URI is the unique identifier for an application, which is registered in Azure AD and used by the application to identify itself when communicating with Azure AD.</span></span> <span data-ttu-id="a36db-148">Pour plus d’informations sur l’URI ID d’application et d’autres propriétés des applications, consultez [cette rubrique](https://msdn.microsoft.com/en-us/library/azure/dn499820.aspx#BKMK_Registering).</span><span class="sxs-lookup"><span data-stu-id="a36db-148">For more information about the App ID URI and other properties of registered applications, see [this topic](https://msdn.microsoft.com/en-us/library/azure/dn499820.aspx#BKMK_Registering).</span></span> <span data-ttu-id="a36db-149">En cliquant sur la case à cocher sous le champ URI ID d’application, vous pouvez également choisir de remplacer une inscription existante dans Azure AD, qui utilise le même URI ID d’application.</span><span class="sxs-lookup"><span data-stu-id="a36db-149">By clicking the checkbox below the App ID URI field, you can also choose to overwrite an existing registration in Azure AD that uses the same App ID URI.</span></span>
4. <span data-ttu-id="a36db-150">Après avoir cliqué sur **OK**, une boîte de dialogue Connexion s’affiche et vous devez vous connecter à l’aide d’un compte d’administrateur général (pas le compte Microsoft associé à votre abonnement).</span><span class="sxs-lookup"><span data-stu-id="a36db-150">After clicking **OK**, a sign-in dialog will appear, and you'll need to sign in using a Global Administrator account (not the Microsoft account associated with your subscription).</span></span> <span data-ttu-id="a36db-151">Si vous avez créé un nouveau compte d’administrateur précédemment, vous allez être amené à modifier le mot de passe et puis vous reconnecter en utilisant le nouveau mot de passe.</span><span class="sxs-lookup"><span data-stu-id="a36db-151">If you created a new Administrator account earlier, you'll be required to change the password and then sign in again using the new password.</span></span>   
  
    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image9.png)
5. <span data-ttu-id="a36db-152">Une fois que vous avez été authentifié avec succès, le **nouveau projet ASP.NET** boîte de dialogue affiche votre choix de l’authentification (**société** ) et le répertoire où la nouvelle application sera inscrite (*aricka0yahoo.onmicrosoft.com* dans l’image ci-dessous).</span><span class="sxs-lookup"><span data-stu-id="a36db-152">After you've successfully authenticated, the **New ASP.NET Project** dialog will show your authentication choice (**Organizational** ) and the directory where the new application will be registered (*aricka0yahoo.onmicrosoft.com* in the image below).</span></span> <span data-ttu-id="a36db-153">Sous ces informations, sélectionnez la case à cocher **hôte dans le cloud**.</span><span class="sxs-lookup"><span data-stu-id="a36db-153">Below this information, select the checkbox labeled **Host in the cloud**.</span></span> <span data-ttu-id="a36db-154">Si cette case à cocher est sélectionnée, le projet sera déployé comme une application web Azure et sera activé pour la publication facile ultérieurement.</span><span class="sxs-lookup"><span data-stu-id="a36db-154">If this checkbox is selected, the project will be provisioned as an Azure web app and will be enabled for easy publishing later.</span></span> <span data-ttu-id="a36db-155">Cliquez sur **OK**.</span><span class="sxs-lookup"><span data-stu-id="a36db-155">Click **OK**.</span></span>   
  
    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image10.png)
6. <span data-ttu-id="a36db-156">Le **configurer le site Web Azure** boîte de dialogue apparaît, à l’aide d’un nom généré automatiquement le site et la région.</span><span class="sxs-lookup"><span data-stu-id="a36db-156">The **Configure Azure Website** dialog will appear, using an auto-generated site name and region.</span></span> <span data-ttu-id="a36db-157">Notez également le compte que vous êtes actuellement connecté dans la boîte de dialogue.</span><span class="sxs-lookup"><span data-stu-id="a36db-157">Also note the account you're currently signed into in the dialog.</span></span> <span data-ttu-id="a36db-158">Vous souhaitez vous assurer que ce compte est celui que votre abonnement Azure est associée, en général, un compte Microsoft.</span><span class="sxs-lookup"><span data-stu-id="a36db-158">You want to make sure that this account is the one that your Azure subscription is attached to, typically a Microsoft account.</span></span>

    > [!NOTE]
    > <span data-ttu-id="a36db-159">Ce projet nécessite une base de données.</span><span class="sxs-lookup"><span data-stu-id="a36db-159">This project requires a database.</span></span> <span data-ttu-id="a36db-160">Vous devez sélectionner une de vos bases de données existants ou créez-en un.</span><span class="sxs-lookup"><span data-stu-id="a36db-160">You need to select one of your existing databases, or create a new one.</span></span> <span data-ttu-id="a36db-161">Une base de données est requise, car le projet utilise déjà un fichier de base de données locale pour stocker une petite quantité de données de configuration de l’authentification.</span><span class="sxs-lookup"><span data-stu-id="a36db-161">A database is required because the project already uses a local database file to store a small amount of authentication configuration data.</span></span> <span data-ttu-id="a36db-162">Lorsque vous déployez l’application sur un site Web Azure, cette base de données n’est pas fourni avec le déploiement, vous devez choisir un qui est accessible dans le cloud.</span><span class="sxs-lookup"><span data-stu-id="a36db-162">When you deploy the application to an Azure Website, this database isn't packaged with the deployment, so you need to choose one that's accessible in the cloud.</span></span> <span data-ttu-id="a36db-163">Cliquez sur **OK**.</span><span class="sxs-lookup"><span data-stu-id="a36db-163">Click **OK**.</span></span>

    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image11.png)
7. <span data-ttu-id="a36db-164">Le projet sera créé, et vos options d’authentification et les options de l’application web seront automatiquement configurées avec le projet.</span><span class="sxs-lookup"><span data-stu-id="a36db-164">The project will be created, and your authentication options and web app options will be automatically configured with the project.</span></span> <span data-ttu-id="a36db-165">Une fois ce processus terminé, exécutez le projet localement en appuyant sur **^ F5**.</span><span class="sxs-lookup"><span data-stu-id="a36db-165">Once this process has completed, run the project locally by pressing **^F5**.</span></span> <span data-ttu-id="a36db-166">Vous devez vous connecter en utilisant votre compte professionnel.</span><span class="sxs-lookup"><span data-stu-id="a36db-166">You will be required to sign in using your organizational account.</span></span> <span data-ttu-id="a36db-167">Fournissez le nom d’utilisateur et un mot de passe pour le compte que vous avez créé précédemment et cliquez sur **connectez-vous**.</span><span class="sxs-lookup"><span data-stu-id="a36db-167">Provide the username and password for the account you created earlier and click **Sign in**.</span></span>   
  
    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image12.png)
8. <span data-ttu-id="a36db-168">Après l’établissement de la connexion, le site ASP.NET affichera que vous avez été authentifié en affichant le nom d’utilisateur dans l’angle supérieur droit de la page.</span><span class="sxs-lookup"><span data-stu-id="a36db-168">After successful sign in, the ASP.NET site will show that you've authenticated by displaying the username in the top right corner of the page.</span></span>  
  
    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image13.png)  
  
 <span data-ttu-id="a36db-169">Si vous obtenez l’erreur :</span><span class="sxs-lookup"><span data-stu-id="a36db-169">If you get the error:</span></span>  
 <span data-ttu-id="a36db-170">Valeur ne peut pas être null ou vide.</span><span class="sxs-lookup"><span data-stu-id="a36db-170">Value cannot be null or empty.</span></span> <span data-ttu-id="a36db-171">Nom du paramètre : linkText</span><span class="sxs-lookup"><span data-stu-id="a36db-171">Parameter name: linkText</span></span>   
    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image14.png)  
  
 <span data-ttu-id="a36db-172">consultez le [déboguer](#dbg) section à la fin du didacticiel.</span><span class="sxs-lookup"><span data-stu-id="a36db-172">see the [debug](#dbg) section at the end of the tutorial.</span></span>

## <a name="basics-of-the-graph-api"></a><span data-ttu-id="a36db-173">Notions de base de l’API Graph</span><span class="sxs-lookup"><span data-stu-id="a36db-173">Basics of the Graph API</span></span>

<span data-ttu-id="a36db-174">[L’API Graph](https://msdn.microsoft.com/en-us/library/azure/hh974476.aspx) est l’interface de programmation permettant d’effectuer CRUD et autres opérations sur les objets dans votre annuaire Azure AD.</span><span class="sxs-lookup"><span data-stu-id="a36db-174">[The Graph API](https://msdn.microsoft.com/en-us/library/azure/hh974476.aspx) is the programmatic interface used to perform CRUD and other operations on objects in your Azure AD directory.</span></span> <span data-ttu-id="a36db-175">Si vous sélectionnez une option de compte professionnel pour l’authentification lors de la création d’un nouveau projet dans Visual Studio 2013, votre application est déjà configurée pour appeler l’API Graph.</span><span class="sxs-lookup"><span data-stu-id="a36db-175">If you select an Organizational Account option for authentication when creating a new project in Visual Studio 2013, your application will already be configured to call the Graph API.</span></span> <span data-ttu-id="a36db-176">Cette section vous montre brièvement le fonctionnement de l’API Graph.</span><span class="sxs-lookup"><span data-stu-id="a36db-176">This section briefly shows you how the Graph API works.</span></span>

1. <span data-ttu-id="a36db-177">Dans votre application en cours d’exécution, cliquez sur le nom de l’utilisateur connecté en haut à droite de la page.</span><span class="sxs-lookup"><span data-stu-id="a36db-177">In your running application, click on the name of the signed-in user at the top right of the page.</span></span> <span data-ttu-id="a36db-178">Cela ouvre la page de profil utilisateur, qui est une action sur le contrôleur Home.</span><span class="sxs-lookup"><span data-stu-id="a36db-178">This will take you to the User Profile page, which is an action on the Home Controller.</span></span> <span data-ttu-id="a36db-179">Vous remarquerez que la table contient des informations utilisateur sur le compte administrateur créé précédemment.</span><span class="sxs-lookup"><span data-stu-id="a36db-179">You'll notice that the table contains user information about the administrator account you created earlier.</span></span> <span data-ttu-id="a36db-180">Ces informations sont stockées dans votre annuaire, et l’API Graph est appelée pour récupérer ces informations lors de la charge de la page.</span><span class="sxs-lookup"><span data-stu-id="a36db-180">This information is stored in your directory, and the Graph API is called to retrieve this information when the page loads.</span></span>   
  
    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image15.png)
2. <span data-ttu-id="a36db-181">Revenez à Visual Studio et développer les **contrôleurs** , puis ouvrez le **HomeController.cs** fichier.</span><span class="sxs-lookup"><span data-stu-id="a36db-181">Go back to Visual Studio and expand the **Controllers** folder and then open the **HomeController.cs** file.</span></span> <span data-ttu-id="a36db-182">Vous verrez un **UserProfile()** action qui contient le code pour récupérer un jeton, puis appeler l’API Graph.</span><span class="sxs-lookup"><span data-stu-id="a36db-182">You'll see a **UserProfile()** action that contains code to retrieve a token and then call the Graph API.</span></span> <span data-ttu-id="a36db-183">Ce code est dupliqué ci-dessous :</span><span class="sxs-lookup"><span data-stu-id="a36db-183">This code is duplicated below:</span></span> 

    [!code-csharp[Main](developing-aspnet-apps-with-windows-azure-active-directory/samples/sample1.cs?highlight=22)]

    <span data-ttu-id="a36db-184">Pour appeler l’API Graph, vous devez d’abord récupérer un jeton.</span><span class="sxs-lookup"><span data-stu-id="a36db-184">To call the Graph API, you first need to retrieve a token.</span></span> <span data-ttu-id="a36db-185">Lorsque le jeton est récupéré, sa valeur de chaîne doit être ajouté dans l’en-tête d’autorisation pour toutes les demandes ultérieures à l’API Graph.</span><span class="sxs-lookup"><span data-stu-id="a36db-185">When the token is retrieved, its string value must be appended in the Authorization header for all subsequent requests to the Graph API.</span></span> <span data-ttu-id="a36db-186">La plupart du code ci-dessus gère les détails de l’authentification à Azure AD pour obtenir un jeton, en utilisant le jeton pour effectuer un appel à l’API Graph, puis pour transformer la réponse afin qu’il peut être présenté dans la vue.</span><span class="sxs-lookup"><span data-stu-id="a36db-186">Most of the code above handles the details of authenticating to Azure AD to get a token, using the token to make a call to the Graph API, and then transforming the response so that it can be presented in the View.</span></span>

    <span data-ttu-id="a36db-187">La partie les plus pertinentes pour la discussion est la ligne en surbrillance suivante : `UserProfile profile = JsonConvert.DeserializeObject<UserProfile>(responseString);`.</span><span class="sxs-lookup"><span data-stu-id="a36db-187">The most relevant portion for discussion is the following highlighted line: `UserProfile profile = JsonConvert.DeserializeObject<UserProfile>(responseString);`.</span></span> <span data-ttu-id="a36db-188">Cette ligne représente le nom de l’utilisateur, ce qui a été désérialisé à partir de la réponse JSON et est présentée dans la vue.</span><span class="sxs-lookup"><span data-stu-id="a36db-188">This line represents the name of the user, which has been deserialized from the JSON response and is presented in the View.</span></span>

    <span data-ttu-id="a36db-189">Vous pouvez appeler l’API Graph à l’aide de HttpClient et gérer vous-même les données brutes, mais un moyen plus simple consiste à utiliser le [bibliothèque cliente de graphique qui est disponible via NuGet](http://www.nuget.org/packages/Microsoft.Azure.ActiveDirectory.GraphClient/).</span><span class="sxs-lookup"><span data-stu-id="a36db-189">You can call the Graph API using HttpClient and handle the raw data yourself, but an easier way is to use the [Graph Client Library which is available via NuGet](http://www.nuget.org/packages/Microsoft.Azure.ActiveDirectory.GraphClient/).</span></span> <span data-ttu-id="a36db-190">La bibliothèque cliente gère les requêtes HTTP bruts et la transformation des données retournées pour vous et le rend beaucoup plus facile de travailler avec l’API Graph dans un environnement .NET.</span><span class="sxs-lookup"><span data-stu-id="a36db-190">The Client Library handles the raw HTTP requests and the transformation of the returned data for you, and makes it much easier to work with the Graph API in a .NET environment.</span></span> <span data-ttu-id="a36db-191">Consultez les exemples de code de l’API Graph connexes sur [GitHub.](https://github.com/AzureADSamples)</span><span class="sxs-lookup"><span data-stu-id="a36db-191">See the related Graph API code samples on [GitHub.](https://github.com/AzureADSamples)</span></span>

## <a name="deploy-the-application-to-azure"></a><span data-ttu-id="a36db-192">Déployer l’Application sur Azure</span><span class="sxs-lookup"><span data-stu-id="a36db-192">Deploy the Application to Azure</span></span>

<span data-ttu-id="a36db-193">Les étapes suivantes vous seront montrent comment déployer l’application sur Azure.</span><span class="sxs-lookup"><span data-stu-id="a36db-193">The following steps will show you how to deploy the application to Azure.</span></span> <span data-ttu-id="a36db-194">Dans les étapes précédentes, vous connecté votre nouveau projet avec une application web sur Azure, il est prêt à être publié dans quelques étapes.</span><span class="sxs-lookup"><span data-stu-id="a36db-194">In the earlier steps, you connected your new project with a web app on Azure, so it's ready to be published in just a few steps.</span></span>

1. <span data-ttu-id="a36db-195">Dans Visual Studio, cliquez sur le projet et sélectionnez **publier**.</span><span class="sxs-lookup"><span data-stu-id="a36db-195">In Visual Studio, right-click on the project and select **Publish**.</span></span> <span data-ttu-id="a36db-196">Le **publier le site Web** boîte de dialogue apparaît avec chaque paramètre déjà configuré.</span><span class="sxs-lookup"><span data-stu-id="a36db-196">The **Publish Web** dialog will appear with each setting already configured.</span></span> <span data-ttu-id="a36db-197">Cliquez sur le **suivant** bouton pour accéder à la **paramètres** page.</span><span class="sxs-lookup"><span data-stu-id="a36db-197">Click on the **Next** button to go to the **Settings** page.</span></span> <span data-ttu-id="a36db-198">Vous pouvez être invité à effectuer l’authentification ; Assurez-vous que vous authentifiez à l’aide de votre compte d’abonnement Azure (en général, un compte Microsoft) et non le compte d’organisation que vous avez créé précédemment.</span><span class="sxs-lookup"><span data-stu-id="a36db-198">You may be prompted to authenticate; make sure you authenticate using your Azure subscription account (typically a Microsoft account) and not the organizational account you created earlier.</span></span>  
  
    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image16.png)
2. <span data-ttu-id="a36db-199">Vérifiez le **activer l’authentification d’organisation** option.</span><span class="sxs-lookup"><span data-stu-id="a36db-199">Check the **Enable Organizational Authentication** option.</span></span> <span data-ttu-id="a36db-200">Dans le **domaine** , saisissez le domaine de votre annuaire.</span><span class="sxs-lookup"><span data-stu-id="a36db-200">In the **Domain** field, enter the domain for your directory.</span></span> <span data-ttu-id="a36db-201">À partir de la **niveau d’accès** liste déroulante, sélectionnez **Single Sign On, les données d’annuaire en lecture**.</span><span class="sxs-lookup"><span data-stu-id="a36db-201">From the **Access Level** drop-down, select **Single Sign On, Read directory data**.</span></span> <span data-ttu-id="a36db-202">Vous remarquerez que la base de données précédente que vous avez utilisé est déjà remplie dans le **bases de données** section.</span><span class="sxs-lookup"><span data-stu-id="a36db-202">You'll notice that the previous database you used is already populated in the **Databases** section.</span></span> <span data-ttu-id="a36db-203">Cliquez sur **Publier**.</span><span class="sxs-lookup"><span data-stu-id="a36db-203">Click **Publish**.</span></span>  
  
    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image17.png)
3. <span data-ttu-id="a36db-204">Visual Studio commence le déploiement de votre site Web, puis une nouvelle fenêtre de navigateur s’affiche.</span><span class="sxs-lookup"><span data-stu-id="a36db-204">Visual Studio will begin deploying your website, and then a new browser window will appear.</span></span> <span data-ttu-id="a36db-205">Vous pouvez être invité à s’authentifier à nouveau à votre annuaire.</span><span class="sxs-lookup"><span data-stu-id="a36db-205">You may be prompted to authenticate to your directory once again.</span></span> <span data-ttu-id="a36db-206">Une fois que vous avez été authentifié, vous serez redirigé vers votre nouveau site Web publié sur Azure.</span><span class="sxs-lookup"><span data-stu-id="a36db-206">Once you've authenticated, you'll be redirected to your newly published website on Azure.</span></span>  
  
    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image18.png)

<a id="dbg"></a>
## <a name="debugging-the-app"></a><span data-ttu-id="a36db-207">Débogage de l’application</span><span class="sxs-lookup"><span data-stu-id="a36db-207">Debugging the app</span></span>

<span data-ttu-id="a36db-208">Si vous obtenez l’erreur suivante :</span><span class="sxs-lookup"><span data-stu-id="a36db-208">If you get the following error:</span></span>   
 <span data-ttu-id="a36db-209">Valeur ne peut pas être null ou vide.</span><span class="sxs-lookup"><span data-stu-id="a36db-209">Value cannot be null or empty.</span></span> <span data-ttu-id="a36db-210">Nom du paramètre : linkText</span><span class="sxs-lookup"><span data-stu-id="a36db-210">Parameter name: linkText</span></span>   
   
![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image19.png)  
  

<span data-ttu-id="a36db-211">Remplacez le code dans le *Views\Shared\\_LoginPartial.cshtml* fichier avec les éléments suivants :</span><span class="sxs-lookup"><span data-stu-id="a36db-211">Replace the code in the *Views\Shared\\_LoginPartial.cshtml* file with the following:</span></span>

[!code-cshtml[Main](developing-aspnet-apps-with-windows-azure-active-directory/samples/sample2.cshtml?highlight=1-8,15-16)]

<span data-ttu-id="a36db-212">Après l’exécution de l’application, si l’utilisateur connecté affiche « Utilisateur », déconnectez-vous et reconnectez-vous avec le compte Active Directory que vous avez créé précédemment.</span><span class="sxs-lookup"><span data-stu-id="a36db-212">After running the app, if the logged in user shows "Null User", sign out, and sign back in with the Active Directory account you created earlier.</span></span>

<span data-ttu-id="a36db-213">Un excellent didacticiel à suivre est de Rick Rainey [approfondie : sites Web Azure et organisation à l’aide d’Azure AD](http://rickrainey.com/2014/08/19/deep-dive-azure-websites-and-organizational-authentication-using-azure-ad/).</span><span class="sxs-lookup"><span data-stu-id="a36db-213">An excellent tutorial to follow is Rick Rainey's [Deep Dive: Azure Websites and Organizational Authentication using Azure AD](http://rickrainey.com/2014/08/19/deep-dive-azure-websites-and-organizational-authentication-using-azure-ad/).</span></span>

## <a name="more-information"></a><span data-ttu-id="a36db-214">Informations complémentaires</span><span class="sxs-lookup"><span data-stu-id="a36db-214">More Information</span></span>

- [<span data-ttu-id="a36db-215">Présentation approfondie : Sites Web Azure et organisation de l’authentification à l’aide d’Azure AD</span><span class="sxs-lookup"><span data-stu-id="a36db-215">Deep Dive: Azure Websites and Organizational Authentication using Azure AD</span></span>](http://rickrainey.com/2014/08/19/deep-dive-azure-websites-and-organizational-authentication-using-azure-ad/)
- [<span data-ttu-id="a36db-216">Présentation de l’API Graph Azure AD</span><span class="sxs-lookup"><span data-stu-id="a36db-216">Azure AD Graph API Overview</span></span>](https://msdn.microsoft.com/en-us/library/azure/hh974476.aspx)
- [<span data-ttu-id="a36db-217">Scénarios d’authentification dans Azure AD</span><span class="sxs-lookup"><span data-stu-id="a36db-217">Authentication Scenarios in Azure AD</span></span>](https://msdn.microsoft.com/en-us/library/azure/dn499820.aspx)
- [<span data-ttu-id="a36db-218">Exemples de Code de Azure AD sur GitHub</span><span class="sxs-lookup"><span data-stu-id="a36db-218">Azure AD Code Samples on GitHub</span></span>](https://github.com/AzureADSamples)
