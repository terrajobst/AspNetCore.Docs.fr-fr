---
uid: identity/overview/getting-started/adding-aspnet-identity-to-an-empty-or-existing-web-forms-project
title: "Ajout d’identité ASP.NET à un site Web vide ou existant Forms projet | Documents Microsoft"
author: raquelsa
description: "Ce didacticiel vous montre comment ajouter l’identité de ASP.NET (le nouveau système d’appartenance pour ASP.NET) à une application ASP.NET. Lorsque vous créez un nouveau Web Forms ou MVC..."
ms.author: aspnetcontent
manager: wpickett
ms.date: 10/23/2013
ms.topic: article
ms.assetid: 1cbc0ed2-5bd6-4b62-8d34-4c193dcd8b25
ms.technology: 
ms.prod: .net-framework
msc.legacyurl: /identity/overview/getting-started/adding-aspnet-identity-to-an-empty-or-existing-web-forms-project
msc.type: authoredcontent
ms.openlocfilehash: f5783287a26174ddf65bb0eae34c347831d02c47
ms.sourcegitcommit: 9a9483aceb34591c97451997036a9120c3fe2baf
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 11/10/2017
---
<a name="adding-aspnet-identity-to-an-empty-or-existing-web-forms-project"></a><span data-ttu-id="49ea7-104">Projet de formulaires Ajout ASP.NET Identity, à un site Web vide ou existant</span><span class="sxs-lookup"><span data-stu-id="49ea7-104">Adding ASP.NET Identity to an Empty or Existing Web Forms Project</span></span>
====================
<span data-ttu-id="49ea7-105">par [Raquel Soares De Almeida](https://github.com/raquelsa)</span><span class="sxs-lookup"><span data-stu-id="49ea7-105">by [Raquel Soares De Almeida](https://github.com/raquelsa)</span></span>

> <span data-ttu-id="49ea7-106">Ce didacticiel vous montre comment ajouter [ASP.NET Identity](introduction-to-aspnet-identity.md) (le nouveau système d’appartenance pour ASP.NET) à une application ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="49ea7-106">This tutorial shows you how to add [ASP.NET Identity](introduction-to-aspnet-identity.md) (the new membership system for ASP.NET) to an ASP.NET application.</span></span>
> 
> <span data-ttu-id="49ea7-107">Lorsque vous créez un nouveau projet Web Forms ou MVC dans Visual Studio 2013 RTM avec des comptes individuels, Visual Studio installera tous les packages requis et ajouter toutes les classes nécessaires pour vous.</span><span class="sxs-lookup"><span data-stu-id="49ea7-107">When you create a new Web Forms or MVC project in Visual Studio 2013 RTM with Individual Accounts, Visual Studio will install all the required packages and add all necessary classes for you.</span></span> <span data-ttu-id="49ea7-108">Ce didacticiel illustre les étapes pour ajouter la prise en charge ASP.NET Identity à votre projet Web Forms existant ou un nouveau projet vide.</span><span class="sxs-lookup"><span data-stu-id="49ea7-108">This tutorial will illustrate the steps to add ASP.NET Identity support to your existing Web Forms project or a new empty project.</span></span> <span data-ttu-id="49ea7-109">J’ai présentent tous les packages NuGet que vous devez installer et vous devez ajouter des classes.</span><span class="sxs-lookup"><span data-stu-id="49ea7-109">I will outline all the NuGet packages you need to install, and classes you need to add.</span></span> <span data-ttu-id="49ea7-110">Je passe en revue les exemples de formulaires Web pour l’inscription de nouveaux utilisateurs et la journalisation lors de la mise en surbrillance toutes les API de point d’entrée principal pour l’authentification et la gestion des utilisateurs.</span><span class="sxs-lookup"><span data-stu-id="49ea7-110">I will go over sample Web Forms for registering new users and logging in while highlighting all main entry point APIs for user management and authentication.</span></span> <span data-ttu-id="49ea7-111">Cet exemple utilise l’implémentation par défaut de ASP.NET Identity pour le stockage de données SQL qui est basé sur Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="49ea7-111">This sample will use the ASP.NET Identity default implementation for SQL data storage which is built on Entity Framework.</span></span> <span data-ttu-id="49ea7-112">Ce didacticiel, nous allons utiliser la base de données locale pour la base de données SQL.</span><span class="sxs-lookup"><span data-stu-id="49ea7-112">This tutorial, we will use LocalDB for the SQL database.</span></span>
> 
> <span data-ttu-id="49ea7-113">Ce didacticiel a été écrit par Raquel Soares De Almeida et Rick Anderson ( [ @RickAndMSFT ](https://twitter.com/#!/RickAndMSFT) ).</span><span class="sxs-lookup"><span data-stu-id="49ea7-113">This tutorial was written by Raquel Soares De Almeida and Rick Anderson ( [@RickAndMSFT](https://twitter.com/#!/RickAndMSFT) ).</span></span>


## <a name="getting-started-aspnet-identity"></a><span data-ttu-id="49ea7-114">Mise en route ASP.NET Identity</span><span class="sxs-lookup"><span data-stu-id="49ea7-114">Getting Started ASP.NET Identity</span></span>

1. <span data-ttu-id="49ea7-115">Commencez par installer et exécuter [Visual Studio Express 2013 pour le Web](https://go.microsoft.com/fwlink/?LinkId=299058) ou [Visual Studio 2013](https://go.microsoft.com/fwlink/?LinkId=306566).</span><span class="sxs-lookup"><span data-stu-id="49ea7-115">Start by installing and running [Visual Studio Express 2013 for Web](https://go.microsoft.com/fwlink/?LinkId=299058) or [Visual Studio 2013](https://go.microsoft.com/fwlink/?LinkId=306566).</span></span>
2. <span data-ttu-id="49ea7-116">Cliquez sur **nouveau projet** à partir du début page, ou vous pouvez utiliser le menu et sélectionnez **fichier**, puis **nouveau projet**.</span><span class="sxs-lookup"><span data-stu-id="49ea7-116">Click **New Project** from the Start page, or you can use the menu and select **File**, and then **New Project**.</span></span>
3. <span data-ttu-id="49ea7-117">Sélectionnez **Visual C# i** n le volet gauche, puis **Web** , puis sélectionnez **Application Web ASP.NET**.</span><span class="sxs-lookup"><span data-stu-id="49ea7-117">Select **Visual C# i** n the left pane, then **Web** and then select **ASP.NET Web Application**.</span></span> <span data-ttu-id="49ea7-118">Nommez votre projet « WebFormsIdentity », puis **OK**.</span><span class="sxs-lookup"><span data-stu-id="49ea7-118">Name your project "WebFormsIdentity" and then click **OK**.</span></span>   
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image1.png)
4. <span data-ttu-id="49ea7-119">Dans le **nouveau projet ASP.NET** boîte de dialogue, sélectionnez le **vide** modèle.</span><span class="sxs-lookup"><span data-stu-id="49ea7-119">In the **New ASP.NET Project** dialog, select the **Empty** template.</span></span>  
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image2.png)  
  
 <span data-ttu-id="49ea7-120">Notez le **modifier l’authentification** bouton est désactivé et aucune prise en charge de l’authentification n’est fourni dans ce modèle.</span><span class="sxs-lookup"><span data-stu-id="49ea7-120">Notice the **Change Authentication** button is disabled and no authentication support is provided in this template.</span></span> <span data-ttu-id="49ea7-121">Les modèles Web Forms, MVC et API Web vous permettent de vous permet de sélectionner la méthode d’authentification.</span><span class="sxs-lookup"><span data-stu-id="49ea7-121">The Web Forms, MVC and Web API templates allow you to select the authentication approach.</span></span> <span data-ttu-id="49ea7-122">Pour plus d’informations, consultez [vue d’ensemble de l’authentification](../../../visual-studio/overview/2013/creating-web-projects-in-visual-studio.md#auth) .</span><span class="sxs-lookup"><span data-stu-id="49ea7-122">For more information, see [Overview of Authentication](../../../visual-studio/overview/2013/creating-web-projects-in-visual-studio.md#auth) .</span></span>

## <a name="adding-identity-packages-to-your-app"></a><span data-ttu-id="49ea7-123">Ajout de Packages de l’identité à votre application</span><span class="sxs-lookup"><span data-stu-id="49ea7-123">Adding Identity Packages to your App</span></span>

<span data-ttu-id="49ea7-124">Dans l’Explorateur de solutions, cliquez sur votre projet et sélectionnez **gérer les Packages NuGet**.</span><span class="sxs-lookup"><span data-stu-id="49ea7-124">In Solution Explorer, right-click your project and select **Manage NuGet Packages**.</span></span> <span data-ttu-id="49ea7-125">Dans la fenêtre de zone de texte Rechercher, tapez «*Identity.E*».</span><span class="sxs-lookup"><span data-stu-id="49ea7-125">In the search text box dialog, type "*Identity.E*".</span></span> <span data-ttu-id="49ea7-126">Cliquez sur Installer pour ce package.</span><span class="sxs-lookup"><span data-stu-id="49ea7-126">Click install for this package.</span></span>   
  
![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image3.png)  
  
<span data-ttu-id="49ea7-127">Notez que ce package installe les packages de dépendance : EntityFramework et Microsoft ASP.NET Identity Core.</span><span class="sxs-lookup"><span data-stu-id="49ea7-127">Note that this package will install the dependency packages: EntityFramework and Microsoft ASP.NET Identity Core.</span></span>

## <a name="adding-web-forms-to-register-users"></a><span data-ttu-id="49ea7-128">Ajout de Web Forms pour inscrire des utilisateurs</span><span class="sxs-lookup"><span data-stu-id="49ea7-128">Adding Web Forms to Register Users</span></span>

1. <span data-ttu-id="49ea7-129">Dans **l’Explorateur de solutions**, avec le bouton droit de votre projet, cliquez sur **ajouter**, puis **Web Form**.</span><span class="sxs-lookup"><span data-stu-id="49ea7-129">In **Solution Explorer**, right-click your project and click **Add**, and then **Web Form**.</span></span>  
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image4.png)
2. <span data-ttu-id="49ea7-130">Dans le **spécifier le nom de l’élément** boîte de dialogue, le nom du nouveau formulaire web **inscrire**, puis cliquez sur **OK**</span><span class="sxs-lookup"><span data-stu-id="49ea7-130">In the **Specify Name for Item** dialog box, name the new web form **Register**, and then click **OK**</span></span>
3. <span data-ttu-id="49ea7-131">Remplacez la balise dans le texte généré *Register.aspx* fichier avec le code ci-dessous.</span><span class="sxs-lookup"><span data-stu-id="49ea7-131">Replace the markup in the generated *Register.aspx* file with the code below.</span></span> <span data-ttu-id="49ea7-132">Les modifications de code sont mis en surbrillance.</span><span class="sxs-lookup"><span data-stu-id="49ea7-132">The code changes are highlighted.</span></span>   

    [!code-aspx[Main](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/samples/sample1.aspx?highlight=9,12-40)]

    > [!NOTE]
    > <span data-ttu-id="49ea7-133">Il s’agit simplement d’une version simplifiée de la *Register.aspx* fichier créé lorsque vous créez un nouveau projet ASP.NET Web Forms.</span><span class="sxs-lookup"><span data-stu-id="49ea7-133">This is just a simplified version of the *Register.aspx* file that is created when you create a new ASP.NET Web Forms project.</span></span> <span data-ttu-id="49ea7-134">Le balisage ci-dessus ajoute des champs de formulaire et un bouton pour inscrire un nouvel utilisateur.</span><span class="sxs-lookup"><span data-stu-id="49ea7-134">The markup above adds form fields and a button to register a new user.</span></span>
4. <span data-ttu-id="49ea7-135">Ouvrez le *Register.aspx.cs* de fichier et remplacez le contenu du fichier par le code suivant :</span><span class="sxs-lookup"><span data-stu-id="49ea7-135">Open the *Register.aspx.cs* file and replace the contents of the file with the following code:</span></span>

    [!code-csharp[Main](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/samples/sample2.cs)]

    > [!NOTE] 
    > 
    > 1. <span data-ttu-id="49ea7-136">Le code ci-dessus est une version simplifiée de la *Register.aspx.cs* fichier créé lorsque vous créez un nouveau projet ASP.NET Web Forms.</span><span class="sxs-lookup"><span data-stu-id="49ea7-136">The code above is a simplified version of the *Register.aspx.cs* file that is created when you create a new ASP.NET Web Forms project.</span></span>
    > 2. <span data-ttu-id="49ea7-137">Le *IdentityUser* classe est l’implémentation EntityFramework par défaut de la *IUser* interface.</span><span class="sxs-lookup"><span data-stu-id="49ea7-137">The *IdentityUser* class is the default EntityFramework implementation of the *IUser* interface.</span></span> <span data-ttu-id="49ea7-138">*IUser* interface est l’interface minimale pour un utilisateur sur ASP.NET Identity Core.</span><span class="sxs-lookup"><span data-stu-id="49ea7-138">*IUser* interface is the minimal interface for a user on ASP.NET Identity Core.</span></span>
    > 3. <span data-ttu-id="49ea7-139">Le *UserStore* classe est l’implémentation EntityFramework par défaut d’un magasin d’utilisateurs.</span><span class="sxs-lookup"><span data-stu-id="49ea7-139">The *UserStore* class is the default EntityFramework implementation of a user store.</span></span> <span data-ttu-id="49ea7-140">Cette classe implémente des interfaces minimales du cœur identité ASP.NET : *IUserStore*, *IUserLoginStore*, *IUserClaimStore* et *IUserRoleStore* .</span><span class="sxs-lookup"><span data-stu-id="49ea7-140">This class implements the ASP.NET Identity Core's minimal interfaces: *IUserStore*, *IUserLoginStore*, *IUserClaimStore* and *IUserRoleStore*.</span></span>
    > 4. <span data-ttu-id="49ea7-141">Le *UserManager* classe expose l’API qui enregistrera automatiquement les modifications associées à la *UserStore*.</span><span class="sxs-lookup"><span data-stu-id="49ea7-141">The *UserManager* class exposes user related APIs which will automatically save changes to the *UserStore*.</span></span>
    > 5. <span data-ttu-id="49ea7-142">Le *IdentityResult* classe représente le résultat d’une opération d’identité.</span><span class="sxs-lookup"><span data-stu-id="49ea7-142">The *IdentityResult* class represents the result of an identity operation.</span></span>
5. <span data-ttu-id="49ea7-143">Dans **l’Explorateur de solutions**, avec le bouton droit de votre projet, cliquez sur **ajouter**, **ajouter le dossier ASP.NET** , puis **application\_données**.</span><span class="sxs-lookup"><span data-stu-id="49ea7-143">In **Solution Explorer**, right-click your project and click **Add**, **Add ASP.NET Folder** and then **App\_Data**.</span></span>  
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image5.png)
6. <span data-ttu-id="49ea7-144">Ouvrez le *Web.config* et ajoutez une entrée de chaîne de connexion pour la base de données, nous allons utiliser pour stocker les informations utilisateur.</span><span class="sxs-lookup"><span data-stu-id="49ea7-144">Open the *Web.config* file and add a connection string entry for the database we will use to store user information.</span></span> <span data-ttu-id="49ea7-145">La base de données sera créée lors de l’exécution par EntityFramework pour les entités d’identité.</span><span class="sxs-lookup"><span data-stu-id="49ea7-145">The database will be created at runtime by EntityFramework for the Identity entities.</span></span> <span data-ttu-id="49ea7-146">La chaîne de connexion est similaire à celui créé pour vous lorsque vous créez un projet Web Forms.</span><span class="sxs-lookup"><span data-stu-id="49ea7-146">The connection string is similar to one created for you when you create a new Web Forms project.</span></span> <span data-ttu-id="49ea7-147">Le code en surbrillance montre le balisage que vous devez ajouter :</span><span class="sxs-lookup"><span data-stu-id="49ea7-147">The highlighted code shows the markup you should add:</span></span>

    [!code-xml[Main](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/samples/sample3.xml?highlight=11-14)]
    
    > [!NOTE] 
    > <span data-ttu-id="49ea7-148">Pour Visual Studio 2015 ou version ultérieure, remplacez `(localdb)\v11.0` avec `(localdb)\MSSQLLocalDB` dans votre chaîne de connexion.</span><span class="sxs-lookup"><span data-stu-id="49ea7-148">For Visual Studio 2015 or higher, replace `(localdb)\v11.0` with `(localdb)\MSSQLLocalDB` in your connection string.</span></span>
    
7. <span data-ttu-id="49ea7-149">Cliquez avec le bouton droit sur fichier *Register.aspx* dans votre projet, puis sélectionnez **définir comme Page de démarrage**.</span><span class="sxs-lookup"><span data-stu-id="49ea7-149">Right click file *Register.aspx* in your project and select **Set as Start Page**.</span></span> <span data-ttu-id="49ea7-150">Appuyez sur Ctrl + F5 pour générer et exécuter l’application web.</span><span class="sxs-lookup"><span data-stu-id="49ea7-150">Press Ctrl + F5 to build and run the web application.</span></span> <span data-ttu-id="49ea7-151">Entrez un nom d’utilisateur et un mot de passe, puis cliquez sur **inscrire**.</span><span class="sxs-lookup"><span data-stu-id="49ea7-151">Enter a new user name and password and then click on **Register**.</span></span>  
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image6.png)  

    > [!NOTE]
    > <span data-ttu-id="49ea7-152">Prend en charge la validation et ASP.NET Identity dans cet exemple, vous pouvez vérifier le comportement par défaut sur l’utilisateur et mot de passe validateurs sont fournis à partir du package de base de l’identité.</span><span class="sxs-lookup"><span data-stu-id="49ea7-152">ASP.NET Identity has support for validation and in this sample you can verify the default behavior on User and Password validators that come from the Identity Core package.</span></span> <span data-ttu-id="49ea7-153">Le programme de validation par défaut pour l’utilisateur (`UserValidator`) a une propriété `AllowOnlyAlphanumericUserNames` qui a la valeur par défaut est définie sur `true`.</span><span class="sxs-lookup"><span data-stu-id="49ea7-153">The default validator for User (`UserValidator`) has a property `AllowOnlyAlphanumericUserNames` that has default value set to `true`.</span></span> <span data-ttu-id="49ea7-154">Le validateur de mot de passe par défaut (`MinimumLengthValidator`) garantit ce mot de passe a au moins 6 caractères.</span><span class="sxs-lookup"><span data-stu-id="49ea7-154">The default validator for Password (`MinimumLengthValidator`) ensures that password has at least 6 characters.</span></span> <span data-ttu-id="49ea7-155">Les validateurs sont des propriétés sur `UserManager` qui peut être remplacée si vous souhaitez une validation personnalisée,</span><span class="sxs-lookup"><span data-stu-id="49ea7-155">These validators are properties on `UserManager` that can be overridden if you want to have custom validation,</span></span>

## <a name="verifying-the-localdb-identity-database-and-tables-generated-by-entity-framework"></a><span data-ttu-id="49ea7-156">Vérification de la base de données de l’identité de la base de données locale et les Tables générées par Entity Framework</span><span class="sxs-lookup"><span data-stu-id="49ea7-156">Verifying the LocalDb Identity Database and Tables Generated by Entity Framework</span></span>

1. <span data-ttu-id="49ea7-157">Dans le **vue** menu, cliquez sur **l’Explorateur de serveurs**.</span><span class="sxs-lookup"><span data-stu-id="49ea7-157">In the **View** menu, click **Server Explorer**.</span></span>  
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image7.png)
2. <span data-ttu-id="49ea7-158">Développez **DefaultConnection (WebFormsIdentity)**, développez **Tables**, cliquez droit **AspNetUsers** et cliquez sur **afficher les données de Table**.</span><span class="sxs-lookup"><span data-stu-id="49ea7-158">Expand **DefaultConnection (WebFormsIdentity)**, expand **Tables**, right click **AspNetUsers** and click **Show Table Data**.</span></span>  
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image8.png)  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image9.png)

## <a name="configuring-the-application-for-owin-authentication"></a><span data-ttu-id="49ea7-159">Configuration de l’application pour l’authentification OWIN</span><span class="sxs-lookup"><span data-stu-id="49ea7-159">Configuring the application for OWIN authentication</span></span>

<span data-ttu-id="49ea7-160">À ce stade nous avons uniquement prise en charge pour la création d’utilisateurs.</span><span class="sxs-lookup"><span data-stu-id="49ea7-160">At this point we have only added support for creating users.</span></span> <span data-ttu-id="49ea7-161">Nous allons à présent, pour illustrer comment nous pouvons ajouter l’authentification pour un utilisateur de se connecter.</span><span class="sxs-lookup"><span data-stu-id="49ea7-161">Now, we are going to demonstrate how we can add authentication to login a user.</span></span> <span data-ttu-id="49ea7-162">ASP.NET Identity utilise l’authentification de Microsoft OWIN intergiciel (middleware) pour l’authentification par formulaire.</span><span class="sxs-lookup"><span data-stu-id="49ea7-162">ASP.NET Identity uses Microsoft OWIN Authentication middleware for forms authentication.</span></span> <span data-ttu-id="49ea7-163">L’authentification de Cookie OWIN est un cookie et le mécanisme d’authentification de base qui peut être utilisé par n’importe quelle infrastructure hébergée sur des revendications [OWIN](https://msdn.microsoft.com/en-us/magazine/dn451439.aspx) ou IIS.</span><span class="sxs-lookup"><span data-stu-id="49ea7-163">The OWIN Cookie Authentication is a cookie and claims based authentication mechanism that can be used by any framework hosted on [OWIN](https://msdn.microsoft.com/en-us/magazine/dn451439.aspx) or IIS.</span></span> <span data-ttu-id="49ea7-164">Avec ce modèle, les packages d’authentification utilisable sur plusieurs infrastructures, y compris ASP.NET MVC et les Web Forms.</span><span class="sxs-lookup"><span data-stu-id="49ea7-164">With this model, the same authentication packages can be used across multiple frameworks including ASP.NET MVC and Web Forms.</span></span> <span data-ttu-id="49ea7-165">Pour plus d’informations sur le projet Katana et comment exécuter l’intergiciel (middleware) dans un voir agnostique hôte [mise en route avec le projet Katana](https://msdn.microsoft.com/en-us/magazine/dn451439.aspx).</span><span class="sxs-lookup"><span data-stu-id="49ea7-165">For more information on project Katana and how to run middleware in a host agnostic see [Getting Started with the Katana Project](https://msdn.microsoft.com/en-us/magazine/dn451439.aspx).</span></span>

## <a name="installing-authentication-packages-to-your-application"></a><span data-ttu-id="49ea7-166">L’installation des packages d’authentification pour votre application</span><span class="sxs-lookup"><span data-stu-id="49ea7-166">Installing authentication packages to your application</span></span>

1. <span data-ttu-id="49ea7-167">Dans l’Explorateur de solutions, cliquez sur votre projet et sélectionnez **gérer les Packages NuGet**.</span><span class="sxs-lookup"><span data-stu-id="49ea7-167">In Solution Explorer, right-click your project and select **Manage NuGet Packages**.</span></span> <span data-ttu-id="49ea7-168">Dans la fenêtre de zone de texte Rechercher, tapez «*Identity.Owin*».</span><span class="sxs-lookup"><span data-stu-id="49ea7-168">In the search text box dialog, type "*Identity.Owin*".</span></span> <span data-ttu-id="49ea7-169">Cliquez sur Installer pour ce package.</span><span class="sxs-lookup"><span data-stu-id="49ea7-169">Click install for this package.</span></span>   
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image10.png)
2. <span data-ttu-id="49ea7-170">Recherchez le package ***Microsoft.Owin.Host.SystemWeb*** et l’installer.</span><span class="sxs-lookup"><span data-stu-id="49ea7-170">Search for package ***Microsoft.Owin.Host.SystemWeb*** and install it.</span></span>   

    > [!NOTE]
    > <span data-ttu-id="49ea7-171">Le **Microsoft.Aspnet.Identity.Owin** package contient un ensemble de classes d’extension OWIN pour gérer et configurer l’intergiciel (middleware) OWIN d’authentification à être consommés par les packages de base d’identité ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="49ea7-171">The **Microsoft.Aspnet.Identity.Owin** package contains a set of OWIN extension classes to manage and configure OWIN authentication middleware to be consumed by ASP.NET Identity Core packages.</span></span>  
    > <span data-ttu-id="49ea7-172">Le **Microsoft.Owin.Host.SystemWeb** package contient un serveur OWIN qui permet aux applications de base OWIN s’exécutent sur IIS à l’aide du pipeline de demande ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="49ea7-172">The **Microsoft.Owin.Host.SystemWeb** package contains an OWIN server that enables OWIN-based applications to run on IIS using the ASP.NET request pipeline.</span></span> <span data-ttu-id="49ea7-173">Pour plus d’informations, consultez [intergiciel OWIN dans IIS intégré pipeline](../../../aspnet/overview/owin-and-katana/owin-middleware-in-the-iis-integrated-pipeline.md).</span><span class="sxs-lookup"><span data-stu-id="49ea7-173">For more information see [OWIN Middleware in the IIS integrated pipeline](../../../aspnet/overview/owin-and-katana/owin-middleware-in-the-iis-integrated-pipeline.md).</span></span>

## <a name="adding-owin-startup-and-authentication-configuration-classes"></a><span data-ttu-id="49ea7-174">Ajout de Classes de Configuration de l’authentification et de démarrage OWIN</span><span class="sxs-lookup"><span data-stu-id="49ea7-174">Adding OWIN Startup and Authentication Configuration Classes</span></span>

1. <span data-ttu-id="49ea7-175">Dans **l’Explorateur de solutions**, avec le bouton droit de votre projet, cliquez sur **ajouter**, puis **ajouter un nouvel élément**.</span><span class="sxs-lookup"><span data-stu-id="49ea7-175">In **Solution Explorer**, right-click your project, click **Add**, and then **Add New Item**.</span></span> <span data-ttu-id="49ea7-176">Dans la fenêtre de zone de texte Rechercher, tapez «*owin*».</span><span class="sxs-lookup"><span data-stu-id="49ea7-176">In the search text box dialog, type "*owin*".</span></span> <span data-ttu-id="49ea7-177">Nom de la classe «*démarrage*» et cliquez sur **ajouter**.</span><span class="sxs-lookup"><span data-stu-id="49ea7-177">Name the class "*Startup*" and click **Add**.</span></span>   
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image11.png)
2. <span data-ttu-id="49ea7-178">Dans le fichier Startup.cs, ajoutez le code en surbrillance ci-dessous pour configurer l’authentification de cookie OWIN.</span><span class="sxs-lookup"><span data-stu-id="49ea7-178">In the Startup.cs file, add the highlighted code shown below to configure OWIN cookie authentication.</span></span>

    [!code-csharp[Main](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/samples/sample4.cs?highlight=1,3,15-19)]

    > [!NOTE]
    > <span data-ttu-id="49ea7-179">Cette classe contient le `OwinStartup` attribut pour spécifier la classe de démarrage OWIN.</span><span class="sxs-lookup"><span data-stu-id="49ea7-179">This class contains the `OwinStartup` attribute for specifying the OWIN startup class.</span></span> <span data-ttu-id="49ea7-180">Chaque application OWIN a une classe de démarrage où vous spécifiez des composants pour le pipeline d’application.</span><span class="sxs-lookup"><span data-stu-id="49ea7-180">Every OWIN application has a startup class where you specify components for the application pipeline.</span></span> <span data-ttu-id="49ea7-181">Consultez [détection de classe de démarrage OWIN](../../../aspnet/overview/owin-and-katana/owin-startup-class-detection.md) pour plus d’informations sur ce modèle.</span><span class="sxs-lookup"><span data-stu-id="49ea7-181">See [OWIN Startup Class Detection](../../../aspnet/overview/owin-and-katana/owin-startup-class-detection.md) for more info on this model.</span></span>

## <a name="adding-web-forms-for-registering-and-logging-in-users"></a><span data-ttu-id="49ea7-182">Ajout de Web Forms pour l’inscription et connexion des utilisateurs</span><span class="sxs-lookup"><span data-stu-id="49ea7-182">Adding Web Forms for Registering and Logging in Users</span></span>

1. <span data-ttu-id="49ea7-183">Ouvrez le *Register.cs* et ajoutez le code suivant qui enregistre l’utilisateur lors de l’inscription réussit.</span><span class="sxs-lookup"><span data-stu-id="49ea7-183">Open the *Register.cs* file and add the following code which will log in the user when registration succeeds.</span></span> <span data-ttu-id="49ea7-184">Les modifications sont mises en surbrillance ci-dessous.</span><span class="sxs-lookup"><span data-stu-id="49ea7-184">The changes are highlighted below.</span></span>

    [!code-csharp[Main](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/samples/sample5.cs)]

    > [!NOTE] 
    > 
    > - <span data-ttu-id="49ea7-185">Étant donné que ASP.NET Identity et l’authentification de Cookie OWIN sont basée sur les revendications du système, l’infrastructure requiert au développeur d’application générer un [ClaimsIdentity](https://msdn.microsoft.com/en-us/library/microsoft.identitymodel.claims.claimsidentity.aspx) pour l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="49ea7-185">Since ASP.NET Identity and OWIN Cookie Authentication are claims based system, the framework requires the app developer to generate a [ClaimsIdentity](https://msdn.microsoft.com/en-us/library/microsoft.identitymodel.claims.claimsidentity.aspx) for the user.</span></span> <span data-ttu-id="49ea7-186">ClaimsIdentity fournit des informations sur toutes les revendications pour l’utilisateur, telles que les rôles de l’utilisateur appartient.</span><span class="sxs-lookup"><span data-stu-id="49ea7-186">ClaimsIdentity has information about all the claims for the user such as what Roles the user belongs to.</span></span> <span data-ttu-id="49ea7-187">Vous pouvez également ajouter plusieurs revendications de l’utilisateur à ce stade.</span><span class="sxs-lookup"><span data-stu-id="49ea7-187">You can also add more claims for the user at this stage.</span></span>
    > - <span data-ttu-id="49ea7-188">Vous pouvez vous connecter l’utilisateur à l’aide de la classe AuthenticationManager de OWIN et en appelant `SignIn` et en passant le ClaimsIdentity comme indiqué ci-dessus.</span><span class="sxs-lookup"><span data-stu-id="49ea7-188">You can sign in the user by using the AuthenticationManager from OWIN and calling `SignIn` and passing in the ClaimsIdentity as shown above.</span></span> <span data-ttu-id="49ea7-189">Ce code sera connectez-vous à l’utilisateur et générer ainsi un cookie.</span><span class="sxs-lookup"><span data-stu-id="49ea7-189">This code will sign in the user and generate a cookie as well.</span></span> <span data-ttu-id="49ea7-190">Cet appel est analogue à [FormAuthentication.SetAuthCookie](https://msdn.microsoft.com/en-us/library/system.web.security.formsauthentication.setauthcookie.aspx) utilisé par le [FormsAuthentication](https://msdn.microsoft.com/en-us/library/system.web.security.formsauthenticationmodule.aspx) module.</span><span class="sxs-lookup"><span data-stu-id="49ea7-190">This call is analogous to [FormAuthentication.SetAuthCookie](https://msdn.microsoft.com/en-us/library/system.web.security.formsauthentication.setauthcookie.aspx) used by the [FormsAuthentication](https://msdn.microsoft.com/en-us/library/system.web.security.formsauthenticationmodule.aspx) module.</span></span>
2. <span data-ttu-id="49ea7-191">Dans **l’Explorateur de solutions**, avec le bouton droit de votre projet, cliquez **ajouter**, puis **Web Form**.</span><span class="sxs-lookup"><span data-stu-id="49ea7-191">In **Solution Explorer**, right-click your project click **Add**, and then **Web Form**.</span></span> <span data-ttu-id="49ea7-192">Nommez le formulaire web **connexion**.</span><span class="sxs-lookup"><span data-stu-id="49ea7-192">Name the web form **Login**.</span></span>  
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image12.png)
3. <span data-ttu-id="49ea7-193">Remplacez le contenu de la *Login.aspx* fichier avec le code suivant :</span><span class="sxs-lookup"><span data-stu-id="49ea7-193">Replace the contents of the *Login.aspx* file with the following code:</span></span>  

    [!code-aspx[Main](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/samples/sample6.aspx)]
4. <span data-ttu-id="49ea7-194">Remplacez le contenu de la *Login.aspx.cs* fichier avec les éléments suivants :</span><span class="sxs-lookup"><span data-stu-id="49ea7-194">Replace the contents of the *Login.aspx.cs* file with the following:</span></span>  

    [!code-csharp[Main](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/samples/sample7.cs)]

    > [!NOTE] 
    > 
    > - <span data-ttu-id="49ea7-195">Le `Page_Load` maintenant vérifie l’état de l’utilisateur actuel et prend des mesures en fonction de son `Context.User.Identity.IsAuthenticated` état.</span><span class="sxs-lookup"><span data-stu-id="49ea7-195">The `Page_Load` now checks for the status of current user and takes action based on its `Context.User.Identity.IsAuthenticated` status.</span></span>  
    >     <span data-ttu-id="49ea7-196">**Afficher enregistrée dans le nom d’utilisateur** : l’infrastructure d’identité Microsoft ASP.NET a ajouté des méthodes d’extension sur [System.Security.Principal.IIdentity](https://msdn.microsoft.com/en-us/library/system.security.principal.iidentity.aspx) qui vous permet d’obtenir le `UserName` et `UserId` pour le Utilisateur connecté.</span><span class="sxs-lookup"><span data-stu-id="49ea7-196">**Display Logged in User Name** : The Microsoft ASP.NET Identity Framework has added extension methods on [System.Security.Principal.IIdentity](https://msdn.microsoft.com/en-us/library/system.security.principal.iidentity.aspx) that allows you to get the `UserName` and `UserId`  for the logged in User.</span></span> <span data-ttu-id="49ea7-197">Ces méthodes d’extension sont définies dans le `Microsoft.AspNet.Identity.Core` assembly.</span><span class="sxs-lookup"><span data-stu-id="49ea7-197">These extension methods are defined in the `Microsoft.AspNet.Identity.Core` assembly.</span></span> <span data-ttu-id="49ea7-198">Ces méthodes d’extension sont le remplacement de [HttpContext.User.Identity.Name](https://msdn.microsoft.com/en-us/library/system.web.httpcontext.user.aspx) .</span><span class="sxs-lookup"><span data-stu-id="49ea7-198">These extension methods are the replacement for [HttpContext.User.Identity.Name](https://msdn.microsoft.com/en-us/library/system.web.httpcontext.user.aspx) .</span></span>
    > - <span data-ttu-id="49ea7-199">Méthode de connexion :</span><span class="sxs-lookup"><span data-stu-id="49ea7-199">SignIn method:</span></span>   
    >     <span data-ttu-id="49ea7-200">`This`méthode remplace la précédente `CreateUser_Click` méthode dans cet exemple et cette maintenant connecte l’utilisateur après la création réussie de l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="49ea7-200">`This` method replaces the previous `CreateUser_Click` method in this sample and now signs in the user after successfully creating the user.</span></span>   
    >  <span data-ttu-id="49ea7-201">L’infrastructure OWIN de Microsoft a ajouté des méthodes d’extension sur `System.Web.HttpContext` qui vous permet d’obtenir une référence à un `IOwinContext`.</span><span class="sxs-lookup"><span data-stu-id="49ea7-201">The Microsoft OWIN Framework has added extension methods on `System.Web.HttpContext` that allows you to get a reference to an `IOwinContext`.</span></span> <span data-ttu-id="49ea7-202">Ces méthodes d’extension sont définies dans `Microsoft.Owin.Host.SystemWeb` assembly.</span><span class="sxs-lookup"><span data-stu-id="49ea7-202">These extension methods are defined in `Microsoft.Owin.Host.SystemWeb` assembly.</span></span> <span data-ttu-id="49ea7-203">Le `OwinContext` classe expose un `IAuthenticationManager` propriété qui représente les fonctionnalités d’intergiciel (middleware) d’authentification disponibles sur la requête actuelle.</span><span class="sxs-lookup"><span data-stu-id="49ea7-203">The `OwinContext` class exposes an `IAuthenticationManager` property that represents the Authentication middleware functionality available on the current request.</span></span>  
    >  <span data-ttu-id="49ea7-204">Vous pouvez vous connecter l’utilisateur à l’aide de la `AuthenticationManager` de OWIN et en appelant `SignIn` et en passant le `ClaimsIdentity` comme indiqué ci-dessus.</span><span class="sxs-lookup"><span data-stu-id="49ea7-204">You can sign in the user by using the `AuthenticationManager` from OWIN and calling `SignIn`  and passing in the `ClaimsIdentity`  as shown above.</span></span>   
    >  <span data-ttu-id="49ea7-205">Identité ASP.NET et authentification de Cookie OWIN étant système basé sur les revendications, le framework requiert que l’application pour générer un `ClaimsIdentity` pour l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="49ea7-205">Because ASP.NET Identity and OWIN Cookie Authentication are claims-based system, the framework requires the app to generate a `ClaimsIdentity` for the user.</span></span>   
    >  <span data-ttu-id="49ea7-206">Le `ClaimsIdentity` a des informations sur toutes les revendications pour l’utilisateur, telles que les rôles de l’utilisateur appartient.</span><span class="sxs-lookup"><span data-stu-id="49ea7-206">The `ClaimsIdentity` has information about all the claims for the user, such as what roles the user belongs to.</span></span> <span data-ttu-id="49ea7-207">Vous pouvez également ajouter plusieurs revendications de l’utilisateur à ce stade</span><span class="sxs-lookup"><span data-stu-id="49ea7-207">You can also add more claims for the user at this stage</span></span>  
    >  <span data-ttu-id="49ea7-208">Ce code sera connectez-vous à l’utilisateur et générer ainsi un cookie.</span><span class="sxs-lookup"><span data-stu-id="49ea7-208">This code will sign in the user and generate a cookie as well.</span></span> <span data-ttu-id="49ea7-209">Cet appel est analogue à [FormAuthentication.SetAuthCookie](https://msdn.microsoft.com/en-us/library/system.web.security.formsauthentication.setauthcookie.aspx) utilisé par le [FormsAuthentication](https://msdn.microsoft.com/en-us/library/system.web.security.formsauthenticationmodule.aspx) module.</span><span class="sxs-lookup"><span data-stu-id="49ea7-209">This call is analogous to [FormAuthentication.SetAuthCookie](https://msdn.microsoft.com/en-us/library/system.web.security.formsauthentication.setauthcookie.aspx) used by the [FormsAuthentication](https://msdn.microsoft.com/en-us/library/system.web.security.formsauthenticationmodule.aspx) module.</span></span>
    > - <span data-ttu-id="49ea7-210">`SignOut`méthode :</span><span class="sxs-lookup"><span data-stu-id="49ea7-210">`SignOut` method:</span></span>   
    >  <span data-ttu-id="49ea7-211">Obtient une référence à la `AuthenticationManager` OWIN et appelle `SignOut`.</span><span class="sxs-lookup"><span data-stu-id="49ea7-211">Gets a reference to the `AuthenticationManager` from OWIN and calls `SignOut`.</span></span> <span data-ttu-id="49ea7-212">Cela est analogue à [FormsAuthentication.SignOut](https://msdn.microsoft.com/en-us/library/system.web.security.formsauthentication.signout.aspx) méthode utilisée par le [FormsAuthentication](https://msdn.microsoft.com/en-us/library/system.web.security.formsauthenticationmodule.aspx) module.</span><span class="sxs-lookup"><span data-stu-id="49ea7-212">This is analogous to [FormsAuthentication.SignOut](https://msdn.microsoft.com/en-us/library/system.web.security.formsauthentication.signout.aspx) method used by the [FormsAuthentication](https://msdn.microsoft.com/en-us/library/system.web.security.formsauthenticationmodule.aspx) module.</span></span>
5. <span data-ttu-id="49ea7-213">Appuyez sur **Ctrl + F5** pour générer et exécuter l’application web.</span><span class="sxs-lookup"><span data-stu-id="49ea7-213">Press **Ctrl + F5** to build and run the web application.</span></span> <span data-ttu-id="49ea7-214">Entrez un nom d’utilisateur et un mot de passe, puis cliquez sur **inscrire**.</span><span class="sxs-lookup"><span data-stu-id="49ea7-214">Enter a new user name and password and then click on **Register**.</span></span>  
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image13.png)  
 <span data-ttu-id="49ea7-215">Remarque : À ce stade, le nouvel utilisateur est créé et enregistré dans.</span><span class="sxs-lookup"><span data-stu-id="49ea7-215">Note: At this point, the new user is created and logged in.</span></span>
6. <span data-ttu-id="49ea7-216">Cliquez sur **déconnecter** bouton. Vous allez être redirigé dans le journal dans le formulaire.</span><span class="sxs-lookup"><span data-stu-id="49ea7-216">Click on **Log out** button.You will be redirected to the Log in form.</span></span>
7. <span data-ttu-id="49ea7-217">Entrez un nom d’utilisateur non valide ou un mot de passe et un clic sur **connecter** bouton.</span><span class="sxs-lookup"><span data-stu-id="49ea7-217">Enter an invalid user name or password and Click on **Log in** button.</span></span>   
 <span data-ttu-id="49ea7-218">Le `UserManager.Find` méthode retournera null et le message d’erreur : « *nom d’utilisateur non valide ou le mot de passe* » s’affiche.</span><span class="sxs-lookup"><span data-stu-id="49ea7-218">The `UserManager.Find`  method will return null and the error message: " *Invalid user name or password* " will be displayed.</span></span>  
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image14.png)
