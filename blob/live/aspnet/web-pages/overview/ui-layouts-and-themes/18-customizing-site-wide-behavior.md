---
uid: web-pages/overview/ui-layouts-and-themes/18-customizing-site-wide-behavior
title: "Personnalisation du comportement de l’échelle du Site pour ASP.NET Web Pages (Razor) Sites | Documents Microsoft"
author: tfitzmac
description: "Ce chapitre explique comment définir des paramètres de votre site Web ou un dossier entier, au lieu de simplement une page."
ms.author: aspnetcontent
manager: wpickett
ms.date: 02/17/2014
ms.topic: article
ms.assetid: e158bed7-226f-4275-b02e-7553bd58c669
ms.technology: dotnet-webpages
ms.prod: .net-framework
msc.legacyurl: /web-pages/overview/ui-layouts-and-themes/18-customizing-site-wide-behavior
msc.type: authoredcontent
ms.openlocfilehash: b1caa26a23517bd976addfefac89375ae965eb91
ms.sourcegitcommit: 9a9483aceb34591c97451997036a9120c3fe2baf
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 11/10/2017
---
<a name="customizing-site-wide-behavior-for-aspnet-web-pages-razor-sites"></a><span data-ttu-id="6267f-103">Personnalisation du comportement de l’échelle du Site pour les Sites ASP.NET Web Pages (Razor)</span><span class="sxs-lookup"><span data-stu-id="6267f-103">Customizing Site-Wide Behavior for ASP.NET Web Pages (Razor) Sites</span></span>
====================
<span data-ttu-id="6267f-104">par [Tom FitzMacken](https://github.com/tfitzmac)</span><span class="sxs-lookup"><span data-stu-id="6267f-104">by [Tom FitzMacken](https://github.com/tfitzmac)</span></span>

> <span data-ttu-id="6267f-105">Cet article explique comment définir des paramètres de site côté pour les pages dans un site Web ASP.NET Web Pages (Razor).</span><span class="sxs-lookup"><span data-stu-id="6267f-105">This article explains how to make site-side settings for pages in an ASP.NET Web Pages (Razor) website.</span></span>
> 
> <span data-ttu-id="6267f-106">Ce que vous allez apprendre :</span><span class="sxs-lookup"><span data-stu-id="6267f-106">What you'll learn:</span></span>
> 
> - <span data-ttu-id="6267f-107">Comment faire pour exécuter du code qui vous permet de jeu de valeurs (valeurs globales ou les paramètres d’assistance) pour toutes les pages dans un site.</span><span class="sxs-lookup"><span data-stu-id="6267f-107">How to run code that lets you set values (global values or helper settings) for all pages in a site.</span></span>
> - <span data-ttu-id="6267f-108">Comment exécuter le code qui vous permet de définir des valeurs pour toutes les pages dans un dossier.</span><span class="sxs-lookup"><span data-stu-id="6267f-108">How to run code that lets you set values for all pages in a folder.</span></span>
> - <span data-ttu-id="6267f-109">Charge de l’exécution de code avant et après une page.</span><span class="sxs-lookup"><span data-stu-id="6267f-109">How to run code before and after a page loads.</span></span>
> - <span data-ttu-id="6267f-110">Comment envoyer les erreurs à une page d’erreurs centrale.</span><span class="sxs-lookup"><span data-stu-id="6267f-110">How to send errors to a central error page.</span></span>
> - <span data-ttu-id="6267f-111">Comment ajouter une authentification à toutes les pages dans un dossier.</span><span class="sxs-lookup"><span data-stu-id="6267f-111">How to add authentication to all pages in a folder.</span></span>
>   
> 
> ## <a name="software-versions-used-in-the-tutorial"></a><span data-ttu-id="6267f-112">Versions du logiciel utilisées dans le didacticiel</span><span class="sxs-lookup"><span data-stu-id="6267f-112">Software versions used in the tutorial</span></span>
> 
> 
> - <span data-ttu-id="6267f-113">Pages Web ASP.NET (Razor) 2</span><span class="sxs-lookup"><span data-stu-id="6267f-113">ASP.NET Web Pages (Razor) 2</span></span>
> - <span data-ttu-id="6267f-114">WebMatrix 3</span><span class="sxs-lookup"><span data-stu-id="6267f-114">WebMatrix 3</span></span>
> - <span data-ttu-id="6267f-115">ASP.NET Web Helpers Library (package NuGet)</span><span class="sxs-lookup"><span data-stu-id="6267f-115">ASP.NET Web Helpers Library (NuGet package)</span></span>
>   
> 
> <span data-ttu-id="6267f-116">Ce didacticiel fonctionne également avec ASP.NET Web Pages 3 et Visual Studio 2013 (ou Visual Studio Express 2013 pour le Web), sauf que vous ne pouvez pas utiliser la bibliothèque de programmes d’assistance ASP.NET Web.</span><span class="sxs-lookup"><span data-stu-id="6267f-116">This tutorial also works with ASP.NET Web Pages 3 and Visual Studio 2013 (or Visual Studio Express 2013 for Web), except you cannot use the ASP.NET Web Helpers Library.</span></span>


<a id="Adding_Website_Startup_Code"></a>
## <a name="adding-website-startup-code-for-aspnet-web-pages"></a><span data-ttu-id="6267f-117">Ajout de Code de démarrage du site Web pour les Pages Web ASP.NET</span><span class="sxs-lookup"><span data-stu-id="6267f-117">Adding Website Startup Code for ASP.NET Web Pages</span></span>

<span data-ttu-id="6267f-118">Pour une grande partie du code que vous écrivez dans les Pages Web ASP.NET, une page individuelle peut contenir tout le code qui est requis pour cette page.</span><span class="sxs-lookup"><span data-stu-id="6267f-118">For much of the code that you write in ASP.NET Web Pages, an individual page can contain all the code that's required for that page.</span></span> <span data-ttu-id="6267f-119">Par exemple, si une page envoie un message électronique, il est possible de placer tout le code pour cette opération dans une seule page.</span><span class="sxs-lookup"><span data-stu-id="6267f-119">For example, if a page sends an email message, it's possible to put all the code for that operation in a single page.</span></span> <span data-ttu-id="6267f-120">Cela peut inclure le code pour initialiser les paramètres pour l’envoi de courrier électronique (autrement dit, pour le serveur SMTP) et pour l’envoi du message électronique.</span><span class="sxs-lookup"><span data-stu-id="6267f-120">This can include the code to initialize the settings for sending email (that is, for the SMTP server) and for sending the email message.</span></span>

<span data-ttu-id="6267f-121">Toutefois, dans certaines situations, vous souhaiterez exécuter du code avant l’exécution de n’importe quelle page sur le site.</span><span class="sxs-lookup"><span data-stu-id="6267f-121">However, in some situations, you might want to run some code before any page on the site runs.</span></span> <span data-ttu-id="6267f-122">Cela est utile pour définir les valeurs qui peuvent être utilisées partout dans le site (appelé *valeurs globales*.) Par exemple, certains programmes d’assistance, que vous devez fournir des valeurs telles que les paramètres de messagerie ou les clés de compte.</span><span class="sxs-lookup"><span data-stu-id="6267f-122">This is useful for setting values that can be used anywhere in the site (referred to as *global values*.) For example, some helpers require you to provide values like email settings or account keys.</span></span> <span data-ttu-id="6267f-123">Il peut être utile de conserver ces paramètres dans les valeurs globales.</span><span class="sxs-lookup"><span data-stu-id="6267f-123">It can be handy to keep these settings in global values.</span></span>

<span data-ttu-id="6267f-124">Vous pouvez pour cela créer une page nommée  *\_AppStart.cshtml* à la racine du site.</span><span class="sxs-lookup"><span data-stu-id="6267f-124">You can do this by creating a page named *\_AppStart.cshtml* in the root of the site.</span></span> <span data-ttu-id="6267f-125">Si cette page existe, il s’exécute la première fois à n’importe quelle page dans le site est demandée.</span><span class="sxs-lookup"><span data-stu-id="6267f-125">If this page exists, it runs the first time any page in the site is requested.</span></span> <span data-ttu-id="6267f-126">Par conséquent, il est judicieux d’exécuter du code pour définir des valeurs globales.</span><span class="sxs-lookup"><span data-stu-id="6267f-126">Therefore, it's a good place to run code to set global values.</span></span> <span data-ttu-id="6267f-127">(Étant donné que  *\_AppStart.cshtml* possède un préfixe de trait de soulignement, ASP.NET n’envoie pas la page à un navigateur même si les utilisateurs demandent directement.)</span><span class="sxs-lookup"><span data-stu-id="6267f-127">(Because *\_AppStart.cshtml* has an underscore prefix, ASP.NET won't send the page to a browser even if users request it directly.)</span></span>

<span data-ttu-id="6267f-128">Le diagramme suivant montre comment la  *\_AppStart.cshtml* page fonctionne.</span><span class="sxs-lookup"><span data-stu-id="6267f-128">The following diagram shows how the *\_AppStart.cshtml* page works.</span></span> <span data-ttu-id="6267f-129">Lorsqu’une demande arrive pour une page, et s’il s’agit la première demande d’une page dans le site, ASP.NET vérifie en premier lieu si un  *\_AppStart.cshtml* page existe.</span><span class="sxs-lookup"><span data-stu-id="6267f-129">When a request comes in for a page, and if this is the first request for any page in the site, ASP.NET first checks whether a *\_AppStart.cshtml* page exists.</span></span> <span data-ttu-id="6267f-130">Dans ce cas, tout code dans le  *\_AppStart.cshtml* page s’exécute et exécute la page demandée.</span><span class="sxs-lookup"><span data-stu-id="6267f-130">If so, any code in the *\_AppStart.cshtml* page runs, and then the requested page runs.</span></span>

![[image]](18-customizing-site-wide-behavior/_static/image1.jpg)

## <a name="setting-global-values-for-your-website"></a><span data-ttu-id="6267f-132">Définition des valeurs globales pour votre site Web</span><span class="sxs-lookup"><span data-stu-id="6267f-132">Setting Global Values for Your Website</span></span>

1. <span data-ttu-id="6267f-133">Dans le dossier racine d’un site Web WebMatrix, créez un fichier nommé  *\_AppStart.cshtml*.</span><span class="sxs-lookup"><span data-stu-id="6267f-133">In the root folder of a WebMatrix website, create a file named *\_AppStart.cshtml*.</span></span> <span data-ttu-id="6267f-134">Le fichier doit être à la racine du site.</span><span class="sxs-lookup"><span data-stu-id="6267f-134">The file must be in the root of the site.</span></span>
2. <span data-ttu-id="6267f-135">Remplacez le contenu existant avec les éléments suivants :</span><span class="sxs-lookup"><span data-stu-id="6267f-135">Replace the existing content with the following:</span></span> 

    [!code-cshtml[Main](18-customizing-site-wide-behavior/samples/sample1.cshtml)]

    <span data-ttu-id="6267f-136">Ce code stocke une valeur dans la `AppState` dictionnaire, qui est automatiquement disponible pour toutes les pages du site.</span><span class="sxs-lookup"><span data-stu-id="6267f-136">This code stores a value in the `AppState` dictionary, which is automatically available to all pages in the site.</span></span> <span data-ttu-id="6267f-137">Notez que la  *\_AppStart.cshtml* fichier n’est pas tout balisage qu’il contient.</span><span class="sxs-lookup"><span data-stu-id="6267f-137">Notice that the *\_AppStart.cshtml* file does not have any markup in it.</span></span> <span data-ttu-id="6267f-138">La page exécuter le code et puis rediriger vers la page initialement demandée.</span><span class="sxs-lookup"><span data-stu-id="6267f-138">The page will run the code and then redirect to the page that was originally requested.</span></span>

    > [!NOTE]
    > <span data-ttu-id="6267f-139">Soyez prudent lorsque vous placez le code dans le  *\_AppStart.cshtml* fichier.</span><span class="sxs-lookup"><span data-stu-id="6267f-139">Be careful when you put code in the *\_AppStart.cshtml* file.</span></span> <span data-ttu-id="6267f-140">Si des erreurs se produisent dans le code dans le  *\_AppStart.cshtml* fichier, le site Web ne démarre pas.</span><span class="sxs-lookup"><span data-stu-id="6267f-140">If any errors occur in code in the *\_AppStart.cshtml* file, the website won't start.</span></span>
3. <span data-ttu-id="6267f-141">Dans le dossier racine, créez une nouvelle page nommée *AppName.cshtml*.</span><span class="sxs-lookup"><span data-stu-id="6267f-141">In the root folder, create a new page named *AppName.cshtml*.</span></span>
4. <span data-ttu-id="6267f-142">Remplacez le balisage par défaut et le code avec les éléments suivants :</span><span class="sxs-lookup"><span data-stu-id="6267f-142">Replace the default markup and code with the following:</span></span> 

    [!code-html[Main](18-customizing-site-wide-behavior/samples/sample2.html)]

    <span data-ttu-id="6267f-143">Ce code extrait la valeur à partir de la `AppState` objet que vous définissez dans le  *\_AppStart.cshtml* page.</span><span class="sxs-lookup"><span data-stu-id="6267f-143">This code extracts the value from the `AppState` object that you set in the *\_AppStart.cshtml* page.</span></span>
5. <span data-ttu-id="6267f-144">Exécutez le *AppName.cshtml* page dans un navigateur.</span><span class="sxs-lookup"><span data-stu-id="6267f-144">Run the *AppName.cshtml* page in a browser.</span></span> <span data-ttu-id="6267f-145">(Assurez-vous que la page est sélectionnée dans le **fichiers** espace de travail avant de l’exécuter.) La page affiche la valeur globale.</span><span class="sxs-lookup"><span data-stu-id="6267f-145">(Make sure the page is selected in the **Files** workspace before you run it.) The page displays the global value.</span></span> 

    ![[image]](18-customizing-site-wide-behavior/_static/image2.jpg)

<a id="Setting_Values_For_Helpers"></a>
## <a name="setting-values-for-helpers"></a><span data-ttu-id="6267f-147">Définition des valeurs pour les programmes d’assistance</span><span class="sxs-lookup"><span data-stu-id="6267f-147">Setting Values for Helpers</span></span>

<span data-ttu-id="6267f-148">Une utilisation optimale pour la  *\_AppStart.cshtml* fichier consiste à définir des valeurs pour les applications d’assistance que vous utilisez dans votre site et qui doivent être initialisés.</span><span class="sxs-lookup"><span data-stu-id="6267f-148">A good use for the *\_AppStart.cshtml* file is to set values for helpers that you use in your site and that have to be initialized.</span></span> <span data-ttu-id="6267f-149">Exemples : paramètres de messagerie pour le `WebMail` programme d’assistance et les clés publiques et privées pour le `ReCaptcha` helper.</span><span class="sxs-lookup"><span data-stu-id="6267f-149">Typical examples are email settings for the `WebMail` helper and the private and public keys for the `ReCaptcha` helper.</span></span> <span data-ttu-id="6267f-150">Dans ce cas, vous pouvez définir les valeurs qu’une seule fois dans le  *\_AppStart.cshtml* et puis ils sont déjà définies pour toutes les pages de votre site.</span><span class="sxs-lookup"><span data-stu-id="6267f-150">In cases like these, you can set the values once in the *\_AppStart.cshtml* and then they're already set for all the pages in your site.</span></span>

<span data-ttu-id="6267f-151">Cette procédure vous montre comment définir `WebMail` paramètres globalement.</span><span class="sxs-lookup"><span data-stu-id="6267f-151">This procedure shows you how to set `WebMail` settings globally.</span></span> <span data-ttu-id="6267f-152">(Pour plus d’informations sur l’utilisation de la `WebMail` assistance, consultez [Ajout du courrier électronique à un Site de Pages Web ASP.NET](../getting-started/11-adding-email-to-your-web-site.md).)</span><span class="sxs-lookup"><span data-stu-id="6267f-152">(For more information about using the `WebMail` helper, see [Adding Email to an ASP.NET Web Pages Site](../getting-started/11-adding-email-to-your-web-site.md).)</span></span>

1. <span data-ttu-id="6267f-153">Ajoutez la bibliothèque de programmes d’assistance ASP.NET Web à votre site Web, comme décrit dans [programmes d’assistance de l’installation dans un Site de Pages Web ASP.NET](https://go.microsoft.com/fwlink/?LinkId=252372), si vous n’avez pas déjà ajouté.</span><span class="sxs-lookup"><span data-stu-id="6267f-153">Add the ASP.NET Web Helpers Library to your website as described in [Installing Helpers in an ASP.NET Web Pages Site](https://go.microsoft.com/fwlink/?LinkId=252372), if you haven't already added it.</span></span>
2. <span data-ttu-id="6267f-154">Si vous n’avez pas déjà un  *\_AppStart.cshtml* de fichiers, dans le dossier racine d’un site Web, créez un fichier nommé  *\_AppStart.cshtml*.</span><span class="sxs-lookup"><span data-stu-id="6267f-154">If you don't already have a *\_AppStart.cshtml* file, in the root folder of a website create a file named *\_AppStart.cshtml*.</span></span>
3. <span data-ttu-id="6267f-155">Ajoutez le code suivant `WebMail` paramètres pour le  *\_AppStart.cshtml* fichier :</span><span class="sxs-lookup"><span data-stu-id="6267f-155">Add the following `WebMail` settings to the *\_AppStart.cshtml* file:</span></span> 

    [!code-cshtml[Main](18-customizing-site-wide-behavior/samples/sample3.cshtml?highlight=2-7)]

    <span data-ttu-id="6267f-156">Modifier les paramètres associés dans le code de messagerie suivantes :</span><span class="sxs-lookup"><span data-stu-id="6267f-156">Modify the following email related settings in the code:</span></span>

    - <span data-ttu-id="6267f-157">Définissez `your-SMTP-host` au nom du serveur SMTP que vous avez accès.</span><span class="sxs-lookup"><span data-stu-id="6267f-157">Set `your-SMTP-host` to the name of the SMTP server that you have access to.</span></span>
    - <span data-ttu-id="6267f-158">Définissez `your-user-name-here` au nom d’utilisateur pour votre compte de serveur SMTP.</span><span class="sxs-lookup"><span data-stu-id="6267f-158">Set `your-user-name-here` to the user name for your SMTP server account.</span></span>
    - <span data-ttu-id="6267f-159">Définissez `your-account-password` au mot de passe pour votre compte de serveur SMTP.</span><span class="sxs-lookup"><span data-stu-id="6267f-159">Set `your-account-password` to the password for your SMTP server account.</span></span>
    - <span data-ttu-id="6267f-160">Définissez `your-email-address-here` à votre adresse de messagerie.</span><span class="sxs-lookup"><span data-stu-id="6267f-160">Set `your-email-address-here` to your own email address.</span></span> <span data-ttu-id="6267f-161">Il s’agit de l’adresse de messagerie, le message est envoyé à partir de.</span><span class="sxs-lookup"><span data-stu-id="6267f-161">This is the email address that the message is sent from.</span></span> <span data-ttu-id="6267f-162">(Certains fournisseurs de messagerie ne vous permettent de spécifier une autre `From` adresse et utilise votre nom d’utilisateur en tant que le `From` adresse.)</span><span class="sxs-lookup"><span data-stu-id="6267f-162">(Some email providers don't let you specify a different `From` address and will use your user name as the `From` address.)</span></span>

    <span data-ttu-id="6267f-163">Pour plus d’informations sur les paramètres SMTP, consultez [configuration des paramètres de messagerie](https://go.microsoft.com/fwlink/?LinkID=202899#configuring_email_settings) dans l’article [envoi de courrier électronique à partir d’un Site ASP.NET Web Pages (Razor)](https://go.microsoft.com/fwlink/?LinkID=202899) et [problèmes liés à l’envoi de courrier électronique](https://go.microsoft.com/fwlink/?LinkId=253001#email)dans les [des Pages Web ASP.NET (Razor) Troubleshooting Guide](https://go.microsoft.com/fwlink/?LinkId=253001).</span><span class="sxs-lookup"><span data-stu-id="6267f-163">For more information about SMTP settings, see [Configuring Email Settings](https://go.microsoft.com/fwlink/?LinkID=202899#configuring_email_settings) in the article [Sending Email from an ASP.NET Web Pages (Razor) Site](https://go.microsoft.com/fwlink/?LinkID=202899) and [Issues with Sending Email](https://go.microsoft.com/fwlink/?LinkId=253001#email) in the [ASP.NET Web Pages (Razor) Troubleshooting Guide](https://go.microsoft.com/fwlink/?LinkId=253001).</span></span>
- <span data-ttu-id="6267f-164">Enregistrer le  *\_AppStart.cshtml* de fichiers et de le fermer.</span><span class="sxs-lookup"><span data-stu-id="6267f-164">Save the *\_AppStart.cshtml* file and close it.</span></span>
- <span data-ttu-id="6267f-165">Dans le dossier racine d’un site Web, créer une nouvelle page nommée *TestEmail.cshtml*.</span><span class="sxs-lookup"><span data-stu-id="6267f-165">In the root folder of a website, create new page named *TestEmail.cshtml*.</span></span>
- <span data-ttu-id="6267f-166">Remplacez le contenu existant avec les éléments suivants :</span><span class="sxs-lookup"><span data-stu-id="6267f-166">Replace the existing content with the following:</span></span> 

    [!code-cshtml[Main](18-customizing-site-wide-behavior/samples/sample4.cshtml)]
- <span data-ttu-id="6267f-167">Exécutez le *TestEmail.cshtml* page dans un navigateur.</span><span class="sxs-lookup"><span data-stu-id="6267f-167">Run the *TestEmail.cshtml* page in a browser.</span></span>
- <span data-ttu-id="6267f-168">Renseignez les champs pour vous envoyer un message électronique, puis cliquez sur **envoyer**.</span><span class="sxs-lookup"><span data-stu-id="6267f-168">Fill in the fields to send yourself an email message and then click **Send**.</span></span>
- <span data-ttu-id="6267f-169">Vérifiez votre adresse de messagerie pour vous assurer que vous avez obtenu le message.</span><span class="sxs-lookup"><span data-stu-id="6267f-169">Check your email to make sure you've gotten the message.</span></span>

<span data-ttu-id="6267f-170">La partie importante de cet exemple est que les paramètres que vous ne modifiez généralement, telles que le nom de votre serveur SMTP et vos informations d’identification de la messagerie, sont définies dans le  *\_AppStart.cshtml* fichier.</span><span class="sxs-lookup"><span data-stu-id="6267f-170">The important part of this example is that the settings that you don't usually change — like the name of your SMTP server and your email credentials — are set in the *\_AppStart.cshtml* file.</span></span> <span data-ttu-id="6267f-171">De cette façon, que vous n’avez pas besoin de les définir à nouveau dans chaque page où vous envoyez par courrier électronique.</span><span class="sxs-lookup"><span data-stu-id="6267f-171">That way you don't need to set them again in each page where you send email.</span></span> <span data-ttu-id="6267f-172">(Bien que si pour une raison quelconque, vous devez modifier ces paramètres, vous pouvez les définir individuellement dans une page.) Dans la page, vous définissez uniquement les valeurs qui sont généralement modifiés chaque fois, telles que le destinataire et le corps du message électronique.</span><span class="sxs-lookup"><span data-stu-id="6267f-172">(Although if for some reason you need to change those settings, you can set them individually in a page.) In the page, you only set the values that typically change each time, like the recipient and the body of the email message.</span></span>

<a id="Running_Code_Before_and_After"></a>
## <a name="running-code-before-and-after-files-in-a-folder"></a><span data-ttu-id="6267f-173">Exécution du Code avant et après les fichiers dans un dossier</span><span class="sxs-lookup"><span data-stu-id="6267f-173">Running Code Before and After Files in a Folder</span></span>

<span data-ttu-id="6267f-174">Tout comme vous pouvez utiliser  *\_AppStart.cshtml* pour écrire du code avant l’exécution de pages du site, vous pouvez écrire du code qui s’exécute avant (et après) n’importe quelle page dans un dossier particulier s’exécuter.</span><span class="sxs-lookup"><span data-stu-id="6267f-174">Just like you can use *\_AppStart.cshtml* to write code before pages in the site run, you can write code that runs before (and after) any page in a particular folder run.</span></span> <span data-ttu-id="6267f-175">Cela est utile pour les éléments tels que la définition de la même page de disposition pour toutes les pages dans un dossier, ou pour le contrôle auquel un utilisateur est connecté avant l’exécution d’une page dans le dossier.</span><span class="sxs-lookup"><span data-stu-id="6267f-175">This is useful for things like setting the same layout page for all the pages in a folder, or for checking that a user is logged in before running a page in the folder.</span></span>

<span data-ttu-id="6267f-176">Pour les pages en particulier des dossiers, vous pouvez créer code dans un fichier nommé  *\_PageStart.cshtml*.</span><span class="sxs-lookup"><span data-stu-id="6267f-176">For pages in particular folders, you can create code in a file named *\_PageStart.cshtml*.</span></span> <span data-ttu-id="6267f-177">Le diagramme suivant montre comment la  *\_PageStart.cshtml* page fonctionne.</span><span class="sxs-lookup"><span data-stu-id="6267f-177">The following diagram shows how the *\_PageStart.cshtml* page works.</span></span> <span data-ttu-id="6267f-178">Lorsqu’une demande arrive pour une page, ASP.NET vérifie en premier une  *\_AppStart.cshtml* page et qui exécute.</span><span class="sxs-lookup"><span data-stu-id="6267f-178">When a request comes in for a page, ASP.NET first checks for a *\_AppStart.cshtml* page and runs that.</span></span> <span data-ttu-id="6267f-179">Ensuite, ASP.NET vérifie s’il existe un  *\_PageStart.cshtml* page, et si tel est le cas, qui s’exécute.</span><span class="sxs-lookup"><span data-stu-id="6267f-179">Then ASP.NET checks whether there's a *\_PageStart.cshtml* page, and if so, runs that.</span></span> <span data-ttu-id="6267f-180">Il exécute ensuite la page demandée.</span><span class="sxs-lookup"><span data-stu-id="6267f-180">It then runs the requested page.</span></span>

<span data-ttu-id="6267f-181">À l’intérieur de la  *\_PageStart.cshtml* page, vous pouvez spécifier où lors du traitement de la page demandée à exécuter en incluant un `RunPage` (méthode).</span><span class="sxs-lookup"><span data-stu-id="6267f-181">Inside the *\_PageStart.cshtml* page, you can specify where during processing you want the requested page to run by including a `RunPage` method.</span></span> <span data-ttu-id="6267f-182">Cela vous permet d’exécuter du code avant l’exécution de la page demandée, puis à nouveau après lui.</span><span class="sxs-lookup"><span data-stu-id="6267f-182">This lets you run code before the requested page runs and then again after it.</span></span> <span data-ttu-id="6267f-183">Si vous n’incluez pas `RunPage`, tout le code dans  *\_PageStart.cshtml* s’exécute, puis sur la page demandée s’exécute automatiquement.</span><span class="sxs-lookup"><span data-stu-id="6267f-183">If you don't include `RunPage`, all the code in *\_PageStart.cshtml* runs, and then the requested page runs automatically.</span></span>

![[image]](18-customizing-site-wide-behavior/_static/image3.jpg)

<span data-ttu-id="6267f-185">ASP.NET vous permet de créer une hiérarchie de  *\_PageStart.cshtml* fichiers.</span><span class="sxs-lookup"><span data-stu-id="6267f-185">ASP.NET lets you create a hierarchy of *\_PageStart.cshtml* files.</span></span> <span data-ttu-id="6267f-186">Vous pouvez placer un  *\_PageStart.cshtml* fichier à la racine du site et dans les sous-dossiers.</span><span class="sxs-lookup"><span data-stu-id="6267f-186">You can put a *\_PageStart.cshtml* file in the root of the site and in any subfolder.</span></span> <span data-ttu-id="6267f-187">Lorsqu’une page est demandée, le  *\_PageStart.cshtml* fichier à l’exécution du niveau le plus élevé (plus proche de la racine du site), suivi par le  *\_PageStart.cshtml* fichier dans la prochaine sous-dossier, et ainsi de suite vers le bas de la structure de sous-dossier jusqu'à ce que la demande atteint le dossier qui contient la page demandée.</span><span class="sxs-lookup"><span data-stu-id="6267f-187">When a page is requested, the *\_PageStart.cshtml* file at the top-most level (nearest to the site root) runs, followed by the *\_PageStart.cshtml* file in the next subfolder, and so on down the subfolder structure until the request reaches the folder that contains the requested page.</span></span> <span data-ttu-id="6267f-188">Une fois tous les applicable  *\_PageStart.cshtml* fichiers ont été exécutés, l’exécution de la page demandée.</span><span class="sxs-lookup"><span data-stu-id="6267f-188">After all the applicable *\_PageStart.cshtml* files have run, the requested page runs.</span></span>

<span data-ttu-id="6267f-189">Par exemple, vous pouvez avoir la combinaison suivante de  *\_PageStart.cshtml* fichiers et *Default.cshtml* fichier :</span><span class="sxs-lookup"><span data-stu-id="6267f-189">For example, you might have the following combination of *\_PageStart.cshtml* files and *Default.cshtml* file:</span></span>

[!code-cshtml[Main](18-customizing-site-wide-behavior/samples/sample5.cshtml)]

[!code-cshtml[Main](18-customizing-site-wide-behavior/samples/sample6.cshtml)]

[!code-cshtml[Main](18-customizing-site-wide-behavior/samples/sample7.cshtml)]

<span data-ttu-id="6267f-190">Lorsque vous exécutez */myfolder/default.cshtml*, vous verrez les éléments suivants :</span><span class="sxs-lookup"><span data-stu-id="6267f-190">When you run */myfolder/default.cshtml*, you'll see the following:</span></span>

[!code-console[Main](18-customizing-site-wide-behavior/samples/sample8.cmd)]

## <a name="running-initialization-code-for-all-pages-in-a-folder"></a><span data-ttu-id="6267f-191">Code d’initialisation en cours d’exécution pour toutes les Pages dans un dossier</span><span class="sxs-lookup"><span data-stu-id="6267f-191">Running Initialization Code for All Pages in a Folder</span></span>

<span data-ttu-id="6267f-192">Une utilisation optimale pour  *\_PageStart.cshtml* fichiers consiste à initialiser la même page de disposition pour tous les fichiers dans un dossier unique.</span><span class="sxs-lookup"><span data-stu-id="6267f-192">A good use for *\_PageStart.cshtml* files is to initialize the same layout page for all files in a single folder.</span></span>

1. <span data-ttu-id="6267f-193">Dans le dossier racine, créez un dossier nommé *InitPages*.</span><span class="sxs-lookup"><span data-stu-id="6267f-193">In the root folder, create a new folder named *InitPages*.</span></span>
2. <span data-ttu-id="6267f-194">Dans le *InitPages* dossier de votre site Web, créez un fichier nommé  *\_PageStart.cshtml* et remplacez le balisage par défaut et le code par le code suivant :</span><span class="sxs-lookup"><span data-stu-id="6267f-194">In the *InitPages* folder of your website, create a file named *\_PageStart.cshtml* and replace the default markup and code with the following:</span></span> 

    [!code-cshtml[Main](18-customizing-site-wide-behavior/samples/sample9.cshtml)]
3. <span data-ttu-id="6267f-195">Dans la racine du site Web, créez un dossier nommé *partagé*.</span><span class="sxs-lookup"><span data-stu-id="6267f-195">In the root of the website, create a folder named *Shared*.</span></span>
4. <span data-ttu-id="6267f-196">Dans le *Shared* dossier, créez un fichier nommé  *\_Layout1.cshtml* et remplacez le balisage par défaut et le code par le code suivant :</span><span class="sxs-lookup"><span data-stu-id="6267f-196">In the *Shared* folder, create a file named *\_Layout1.cshtml* and replace the default markup and code with the following:</span></span> 

    [!code-cshtml[Main](18-customizing-site-wide-behavior/samples/sample10.cshtml)]
5. <span data-ttu-id="6267f-197">Dans le *InitPages* dossier, créez un fichier nommé *Content1.cshtml* et remplacer le contenu existant par le code suivant :</span><span class="sxs-lookup"><span data-stu-id="6267f-197">In the *InitPages* folder, create a file named *Content1.cshtml* and replace the existing content with the following:</span></span> 

    [!code-html[Main](18-customizing-site-wide-behavior/samples/sample11.html)]
6. <span data-ttu-id="6267f-198">Dans le *InitPages* dossier, créez un autre fichier nommé *Content2.cshtml* et remplacez le balisage par défaut avec les éléments suivants :</span><span class="sxs-lookup"><span data-stu-id="6267f-198">In the *InitPages* folder, create another file named *Content2.cshtml* and replace the default markup with the following:</span></span> 

    [!code-html[Main](18-customizing-site-wide-behavior/samples/sample12.html)]
7. <span data-ttu-id="6267f-199">Exécutez *Content1.cshtml* dans un navigateur.</span><span class="sxs-lookup"><span data-stu-id="6267f-199">Run *Content1.cshtml* in a browser.</span></span> 

    ![[image]](18-customizing-site-wide-behavior/_static/image4.jpg)

    <span data-ttu-id="6267f-201">Lorsque le *Content1.cshtml* page s’exécute, le  *\_PageStart.cshtml* fichier définit `Layout` et définit également `PageData["MyBackground"]` une couleur.</span><span class="sxs-lookup"><span data-stu-id="6267f-201">When the *Content1.cshtml* page runs, the *\_PageStart.cshtml* file sets `Layout` and also sets `PageData["MyBackground"]` to a color.</span></span> <span data-ttu-id="6267f-202">Dans *Content1.cshtml*, la disposition et les couleurs sont appliquées.</span><span class="sxs-lookup"><span data-stu-id="6267f-202">In *Content1.cshtml*, the layout and color are applied.</span></span>
8. <span data-ttu-id="6267f-203">Affichage *Content2.cshtml* dans un navigateur.</span><span class="sxs-lookup"><span data-stu-id="6267f-203">Display *Content2.cshtml* in a browser.</span></span> 

    <span data-ttu-id="6267f-204">La disposition est la même, étant donné que les deux pages utilisent la même page de disposition et la couleur comme initialisé dans  *\_PageStart.cshtml*.</span><span class="sxs-lookup"><span data-stu-id="6267f-204">The layout is the same, because both pages use the same layout page and color as initialized in *\_PageStart.cshtml*.</span></span>

## <a name="using-pagestartcshtml-to-handle-errors"></a><span data-ttu-id="6267f-205">À l’aide de \_PageStart.cshtml pour gérer les erreurs</span><span class="sxs-lookup"><span data-stu-id="6267f-205">Using \_PageStart.cshtml to Handle Errors</span></span>

<span data-ttu-id="6267f-206">Une autre bonne utiliser pour le  *\_PageStart.cshtml* fichier consiste à créer un moyen de gérer les erreurs de programmation (exceptions) qui peuvent se produire dans les *.cshtml* page dans un dossier.</span><span class="sxs-lookup"><span data-stu-id="6267f-206">Another good use for the *\_PageStart.cshtml* file is to create a way to handle programming errors (exceptions) that might occur in any *.cshtml* page in a folder.</span></span> <span data-ttu-id="6267f-207">Cet exemple montre une façon de procéder.</span><span class="sxs-lookup"><span data-stu-id="6267f-207">This example shows you one way to do this.</span></span>

1. <span data-ttu-id="6267f-208">Dans le dossier racine, créez un dossier nommé *InitCatch*.</span><span class="sxs-lookup"><span data-stu-id="6267f-208">In the root folder, create a folder named *InitCatch*.</span></span>
2. <span data-ttu-id="6267f-209">Dans le *InitCatch* dossier de votre site Web, créez un fichier nommé  *\_PageStart.cshtml* et remplacez le balisage existant et le code par le code suivant :</span><span class="sxs-lookup"><span data-stu-id="6267f-209">In the *InitCatch* folder of your website, create a file named *\_PageStart.cshtml* and replace the existing markup and code with the following:</span></span> 

    [!code-cshtml[Main](18-customizing-site-wide-behavior/samples/sample13.cshtml)]

    <span data-ttu-id="6267f-210">Dans ce code, vous exécutez la page demandée explicitement en appelant le `RunPage` méthode à l’intérieur d’un `try` bloc.</span><span class="sxs-lookup"><span data-stu-id="6267f-210">In this code, you try running the requested page explicitly by calling the `RunPage` method inside a `try` block.</span></span> <span data-ttu-id="6267f-211">Si des erreurs de programmation se produisent dans demandé de page, le code à l’intérieur de la `catch` bloc s’exécute.</span><span class="sxs-lookup"><span data-stu-id="6267f-211">If any programming errors occur in the requested page, the code inside the `catch` block runs.</span></span> <span data-ttu-id="6267f-212">Dans ce cas, le code redirige vers une page (*Error.cshtml*) et transmet le nom du fichier qui a rencontré l’erreur dans le cadre de l’URL.</span><span class="sxs-lookup"><span data-stu-id="6267f-212">In this case, the code redirects to a page (*Error.cshtml*) and passes the name of the file that experienced the error as part of the URL.</span></span> <span data-ttu-id="6267f-213">(Vous allez créer la page dans quelques instants.)</span><span class="sxs-lookup"><span data-stu-id="6267f-213">(You'll create the page shortly.)</span></span>
3. <span data-ttu-id="6267f-214">Dans le *InitCatch* dossier de votre site Web, créez un fichier nommé *Exception.cshtml* et remplacez le balisage existant et le code par le code suivant :</span><span class="sxs-lookup"><span data-stu-id="6267f-214">In the *InitCatch* folder of your website, create a file named *Exception.cshtml* and replace the existing markup and code with the following:</span></span> 

    [!code-cshtml[Main](18-customizing-site-wide-behavior/samples/sample14.cshtml)]

    <span data-ttu-id="6267f-215">Pour des raisons de cet exemple, ce que vous faites dans cette page sont délibérément création d’une erreur en essayant d’ouvrir un fichier de base de données qui n’existe pas.</span><span class="sxs-lookup"><span data-stu-id="6267f-215">For purposes of this example, what you're doing in this page is deliberately creating an error by trying to open a database file that doesn't exist.</span></span>
4. <span data-ttu-id="6267f-216">Dans le dossier racine, créez un fichier nommé *Error.cshtml* et remplacez le balisage existant et le code par le code suivant :</span><span class="sxs-lookup"><span data-stu-id="6267f-216">In the root folder, create a file named *Error.cshtml* and replace the existing markup and code with the following:</span></span> 

    [!code-html[Main](18-customizing-site-wide-behavior/samples/sample15.html)]

    <span data-ttu-id="6267f-217">Dans cette page, l’expression `@Request["source"]` Obtient la valeur de l’URL et l’affiche.</span><span class="sxs-lookup"><span data-stu-id="6267f-217">In this page, the expression `@Request["source"]` gets the value out of the URL and displays it.</span></span>
5. <span data-ttu-id="6267f-218">Dans la barre d’outils, cliquez sur **enregistrer**.</span><span class="sxs-lookup"><span data-stu-id="6267f-218">In the toolbar, click **Save**.</span></span>
6. <span data-ttu-id="6267f-219">Exécutez *Exception.cshtml* dans un navigateur.</span><span class="sxs-lookup"><span data-stu-id="6267f-219">Run *Exception.cshtml* in a browser.</span></span> 

    ![[image]](18-customizing-site-wide-behavior/_static/image5.jpg)

    <span data-ttu-id="6267f-221">Car une erreur se produit dans *Exception.cshtml*, le  *\_PageStart.cshtml* page redirige vers le *Error.cshtml* fichier, qui affiche le message.</span><span class="sxs-lookup"><span data-stu-id="6267f-221">Because an error occurs in *Exception.cshtml*, the *\_PageStart.cshtml* page redirects to the *Error.cshtml* file, which displays the message.</span></span>

    <span data-ttu-id="6267f-222">Pour plus d’informations sur les exceptions, consultez [Introduction à ASP.NET Web Pages de programmation à l’aide de la syntaxe Razor](https://go.microsoft.com/fwlink/?LinkID=251587).</span><span class="sxs-lookup"><span data-stu-id="6267f-222">For more information about exceptions, see [Introduction to ASP.NET Web Pages Programming Using the Razor Syntax](https://go.microsoft.com/fwlink/?LinkID=251587).</span></span>

<a id="Using__PageStart.cshtml_to_Restrict_Folder_Access"></a>
## <a name="using-pagestartcshtml-to-restrict-folder-access"></a><span data-ttu-id="6267f-223">À l’aide de \_PageStart.cshtml pour restreindre l’accès au dossier</span><span class="sxs-lookup"><span data-stu-id="6267f-223">Using \_PageStart.cshtml to Restrict Folder Access</span></span>

<span data-ttu-id="6267f-224">Vous pouvez également utiliser le  *\_PageStart.cshtml* fichier pour restreindre l’accès à tous les fichiers dans un dossier.</span><span class="sxs-lookup"><span data-stu-id="6267f-224">You can also use the *\_PageStart.cshtml* file to restrict access to all the files in a folder.</span></span>

1. <span data-ttu-id="6267f-225">Dans WebMatrix, créez un nouveau site Web à l’aide du **Site à partir du modèle** option.</span><span class="sxs-lookup"><span data-stu-id="6267f-225">In WebMatrix, create a new website using the **Site From Template** option.</span></span>
2. <span data-ttu-id="6267f-226">Dans les modèles disponibles, sélectionnez **Starter Site**.</span><span class="sxs-lookup"><span data-stu-id="6267f-226">From the available templates, select **Starter Site**.</span></span>
3. <span data-ttu-id="6267f-227">Dans le dossier racine, créez un dossier nommé *AuthenticatedContent*.</span><span class="sxs-lookup"><span data-stu-id="6267f-227">In the root folder, create a folder named *AuthenticatedContent*.</span></span>
4. <span data-ttu-id="6267f-228">Dans le *AuthenticatedContent* dossier, créez un fichier nommé  *\_PageStart.cshtml* et remplacez le balisage existant et le code par le code suivant :</span><span class="sxs-lookup"><span data-stu-id="6267f-228">In the *AuthenticatedContent* folder, create a file named *\_PageStart.cshtml* and replace the existing markup and code with the following:</span></span> 

    [!code-cshtml[Main](18-customizing-site-wide-behavior/samples/sample16.cshtml)]

    <span data-ttu-id="6267f-229">Le code commence en empêchant que tous les fichiers dans le dossier mis en cache.</span><span class="sxs-lookup"><span data-stu-id="6267f-229">The code starts by preventing all files in the folder from being cached.</span></span> <span data-ttu-id="6267f-230">(Cela est nécessaire pour les scénarios, tels que des ordinateurs publics, où vous souhaitez les pages mises en cache d’un utilisateur soit disponible pour l’utilisateur suivant). Ensuite, le code détermine si l’utilisateur est connecté au site avant de pouvoir afficher les pages dans le dossier.</span><span class="sxs-lookup"><span data-stu-id="6267f-230">(This is required for scenarios like public computers, where you don't want one user's cached pages to be available to the next user.) Next, the code determines whether the user has signed in to the site before they can view any of the pages in the folder.</span></span> <span data-ttu-id="6267f-231">Si l’utilisateur n’est pas connecté, le code redirige vers la page de connexion.</span><span class="sxs-lookup"><span data-stu-id="6267f-231">If the user is not signed in, the code redirects to the login page.</span></span> <span data-ttu-id="6267f-232">La page de connexion peut retourner l’utilisateur à la page qui a été demandée à l’origine si vous incluez une valeur de chaîne de requête nommée `ReturnUrl`.</span><span class="sxs-lookup"><span data-stu-id="6267f-232">The login page can return the user to the page that was originally requested if you include a query string value named `ReturnUrl`.</span></span>
5. <span data-ttu-id="6267f-233">Créer une nouvelle page dans le *AuthenticatedContent* dossier nommé *Page.cshtml*.</span><span class="sxs-lookup"><span data-stu-id="6267f-233">Create a new page in the *AuthenticatedContent* folder named *Page.cshtml*.</span></span>
6. <span data-ttu-id="6267f-234">Remplacez le balisage par défaut avec les éléments suivants :</span><span class="sxs-lookup"><span data-stu-id="6267f-234">Replace the default markup with the following:</span></span>  

    [!code-cshtml[Main](18-customizing-site-wide-behavior/samples/sample17.cshtml)]
7. <span data-ttu-id="6267f-235">Exécutez *Page.cshtml* dans un navigateur.</span><span class="sxs-lookup"><span data-stu-id="6267f-235">Run *Page.cshtml* in a browser.</span></span> <span data-ttu-id="6267f-236">Le code vous redirige vers une page de connexion.</span><span class="sxs-lookup"><span data-stu-id="6267f-236">The code redirects you to a login page.</span></span> <span data-ttu-id="6267f-237">Vous devez l’enregistrer avant de vous connecter.</span><span class="sxs-lookup"><span data-stu-id="6267f-237">You must register before logging in.</span></span> <span data-ttu-id="6267f-238">Une fois que vous avez enregistré et connecté, vous pouvez accéder à la page et afficher son contenu.</span><span class="sxs-lookup"><span data-stu-id="6267f-238">After you've registered and logged in, you can navigate to the page and view its contents.</span></span>

<a id="Additional_Resources"></a>
## <a name="additional-resources"></a><span data-ttu-id="6267f-239">Ressources supplémentaires</span><span class="sxs-lookup"><span data-stu-id="6267f-239">Additional Resources</span></span>

[<span data-ttu-id="6267f-240">Introduction à la programmation à l’aide de la syntaxe Razor ASP.NET Web Pages</span><span class="sxs-lookup"><span data-stu-id="6267f-240">Introduction to ASP.NET Web Pages Programming Using the Razor Syntax</span></span>](https://go.microsoft.com/fwlink/?LinkID=251587)
