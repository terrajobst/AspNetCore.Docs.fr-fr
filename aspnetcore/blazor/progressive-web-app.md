---
title: Créez des applications Web progressifs avec ASP.NET Core Blazor webassembly
author: guardrex
description: Découvrez comment créer une application Web progressive (PWA) basée sur Blazorqui utilise des fonctionnalités de navigateur modernes pour se comporter comme une application de bureau.
monikerRange: '>= aspnetcore-3.1'
ms.author: riande
ms.custom: mvc
ms.date: 03/12/2020
no-loc:
- Blazor
- SignalR
uid: blazor/progressive-web-app
ms.openlocfilehash: 53e1c4d043c0e8faf13668989cda1f1245c7157a
ms.sourcegitcommit: 9b6e7f421c243963d5e419bdcfc5c4bde71499aa
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 03/21/2020
ms.locfileid: "79989598"
---
# <a name="build-progressive-web-applications-with-aspnet-core-blazor-webassembly"></a><span data-ttu-id="5d289-103">Créez des applications Web progressifs avec ASP.NET Core webassembly éblouissant</span><span class="sxs-lookup"><span data-stu-id="5d289-103">Build Progressive Web Applications with ASP.NET Core Blazor WebAssembly</span></span>

<span data-ttu-id="5d289-104">Par [Steve Sanderson](https://github.com/SteveSandersonMS)</span><span class="sxs-lookup"><span data-stu-id="5d289-104">By [Steve Sanderson](https://github.com/SteveSandersonMS)</span></span>

[!INCLUDE[](~/includes/blazorwasm-preview-notice.md)]

[!INCLUDE[](~/includes/blazorwasm-3.2-template-article-notice.md)]

<span data-ttu-id="5d289-105">Une application Web progressive (PWA) est une application à page unique (SPA) qui utilise des API et des fonctionnalités de navigateur modernes pour se comporter comme une application de bureau.</span><span class="sxs-lookup"><span data-stu-id="5d289-105">A Progressive Web Application (PWA) is a Single Page Application (SPA) that uses modern browser APIs and capabilities to behave like a desktop app.</span></span> <span data-ttu-id="5d289-106">Le webassembly éblouissant est une plate-forme d’application Web côté client basée sur des normes. il peut donc utiliser n’importe quelle API de navigateur, y compris les API PWA requises pour les fonctionnalités suivantes :</span><span class="sxs-lookup"><span data-stu-id="5d289-106">Blazor WebAssembly is a standards-based client-side web app platform, so it can use any browser API, including PWA APIs required for the following capabilities:</span></span>

* <span data-ttu-id="5d289-107">Travailler en mode hors connexion et se charger instantanément, indépendamment de la vitesse du réseau.</span><span class="sxs-lookup"><span data-stu-id="5d289-107">Working offline and loading instantly, independent of network speed.</span></span>
* <span data-ttu-id="5d289-108">S’exécutant dans sa propre fenêtre d’application, et pas seulement dans une fenêtre de navigateur.</span><span class="sxs-lookup"><span data-stu-id="5d289-108">Running in its own app window, not just a browser window.</span></span>
* <span data-ttu-id="5d289-109">Lancé à partir du menu Démarrer, de l’ancrage ou de l’écran d’accueil du système d’exploitation de l’hôte.</span><span class="sxs-lookup"><span data-stu-id="5d289-109">Being launched from the host's operating system start menu, dock, or home screen.</span></span>
* <span data-ttu-id="5d289-110">Réception de notifications push à partir d’un serveur principal, même si l’utilisateur n’utilise pas l’application.</span><span class="sxs-lookup"><span data-stu-id="5d289-110">Receiving push notifications from a backend server, even while the user isn't using the app.</span></span>
* <span data-ttu-id="5d289-111">Mise à jour automatique en arrière-plan.</span><span class="sxs-lookup"><span data-stu-id="5d289-111">Automatically updating in the background.</span></span>

<span data-ttu-id="5d289-112">Le mot *progressif* est utilisé pour décrire de telles applications, car :</span><span class="sxs-lookup"><span data-stu-id="5d289-112">The word *progressive* is used to describe such apps because:</span></span>

* <span data-ttu-id="5d289-113">Un utilisateur peut tout d’abord découvrir et utiliser l’application dans son navigateur Web comme n’importe quel autre SPA.</span><span class="sxs-lookup"><span data-stu-id="5d289-113">A user might first discover and use the app within their web browser like any other SPA.</span></span>
* <span data-ttu-id="5d289-114">Plus tard, l’utilisateur est en mesure de l’installer dans son système d’exploitation et d’activer les notifications push.</span><span class="sxs-lookup"><span data-stu-id="5d289-114">Later, the user progresses to installing it in their OS and enabling push notifications.</span></span>

## <a name="create-a-project-from-the-pwa-template"></a><span data-ttu-id="5d289-115">Créer un projet à partir du modèle PWA</span><span class="sxs-lookup"><span data-stu-id="5d289-115">Create a project from the PWA template</span></span>

# <a name="visual-studio"></a>[<span data-ttu-id="5d289-116">Visual Studio</span><span class="sxs-lookup"><span data-stu-id="5d289-116">Visual Studio</span></span>](#tab/visual-studio)

<span data-ttu-id="5d289-117">Quand vous créez une **application de Webassembly éblouissante** dans la boîte de dialogue **créer un nouveau projet** , activez la case à cocher progression de l' **application Web** :</span><span class="sxs-lookup"><span data-stu-id="5d289-117">When creating a new **Blazor WebAssembly App** in the **Create a New Project** dialog, select the **Progress Web Application** check box:</span></span>

![La case à cocher « application Web progressive » est activée dans la boîte de dialogue Nouveau projet de Visual Studio.](progressive-web-app/_static/image1.png)

<!--

# [Visual Studio for Mac](#tab/visual-studio-mac)

-->

# <a name="visual-studio-code--net-core-cli"></a>[<span data-ttu-id="5d289-119">Visual Studio Code/.NET Core CLI</span><span class="sxs-lookup"><span data-stu-id="5d289-119">Visual Studio Code / .NET Core CLI</span></span>](#tab/visual-studio-code+netcore-cli)

<span data-ttu-id="5d289-120">Créez un projet PWA dans une interface de commande avec le commutateur `--pwa` :</span><span class="sxs-lookup"><span data-stu-id="5d289-120">Create a PWA project in a command shell with the `--pwa` switch:</span></span>

```dotnetcli
dotnet new blazorwasm -o MyNewProject --pwa
```

---

<span data-ttu-id="5d289-121">Éventuellement, PWA peut être configuré pour une application créée à partir du modèle ASP.NET Core hébergé.</span><span class="sxs-lookup"><span data-stu-id="5d289-121">Optionally, PWA can be configured for an app created from the ASP.NET Core Hosted template.</span></span> <span data-ttu-id="5d289-122">Le scénario PWA est indépendant du modèle d’hébergement.</span><span class="sxs-lookup"><span data-stu-id="5d289-122">The PWA scenario is independent of the hosting model.</span></span>

## <a name="installation-and-app-manifest"></a><span data-ttu-id="5d289-123">Manifeste d’installation et d’application</span><span class="sxs-lookup"><span data-stu-id="5d289-123">Installation and app manifest</span></span>

<span data-ttu-id="5d289-124">Quand vous visitez une application créée à l’aide du modèle PWA, les utilisateurs ont la possibilité d’installer l’application dans le menu Démarrer, l’ancre ou l’écran d’accueil de son système d’exploitation.</span><span class="sxs-lookup"><span data-stu-id="5d289-124">When visiting an app created using the PWA template, users have the option of installing the app into their OS's start menu, dock, or home screen.</span></span> <span data-ttu-id="5d289-125">La façon dont cette option est présentée dépend du navigateur de l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="5d289-125">The way this option is presented depends on the user's browser.</span></span> <span data-ttu-id="5d289-126">Quand vous utilisez des navigateurs basés sur Desktop chrome, tels que Edge ou chrome, un bouton **Ajouter** apparaît dans la barre d’URL.</span><span class="sxs-lookup"><span data-stu-id="5d289-126">When using desktop Chromium-based browsers, such as Edge or Chrome, an **Add** button appears within the URL bar.</span></span> <span data-ttu-id="5d289-127">Une fois que l’utilisateur a sélectionné le bouton **Ajouter** , une boîte de dialogue de confirmation s’affiche :</span><span class="sxs-lookup"><span data-stu-id="5d289-127">After the user selects the **Add** button, they receive a confirmation dialog:</span></span>

![Le diaglog de confirmation de Google Chrome présente un bouton installer pour l’utilisateur de l’application « MyBlazorPwa ».](progressive-web-app/_static/image2.png)

<span data-ttu-id="5d289-129">Sur iOS, les visiteurs peuvent installer le PWA à l’aide du bouton de **partage** de Safari et de l’option **Ajouter à homescreen** .</span><span class="sxs-lookup"><span data-stu-id="5d289-129">On iOS, visitors can install the PWA using Safari's **Share** button and its **Add to Homescreen** option.</span></span> <span data-ttu-id="5d289-130">Sur chrome pour Android, les utilisateurs doivent sélectionner le bouton de **menu** dans l’angle supérieur droit, puis **Ajouter à l’écran d’accueil**.</span><span class="sxs-lookup"><span data-stu-id="5d289-130">On Chrome for Android, users should select the **Menu** button in the upper-right corner, followed by **Add to Home screen**.</span></span>

<span data-ttu-id="5d289-131">Une fois installé, l’application s’affiche dans sa propre fenêtre sans barre d’adresses :</span><span class="sxs-lookup"><span data-stu-id="5d289-131">Once installed, the app appears in its own window without an address bar:</span></span>

![L’application « MyBlazorPwa » s’exécute dans Google Chrome sans barre d’adresses.](progressive-web-app/_static/image3.png)

<span data-ttu-id="5d289-133">Pour personnaliser le titre, le modèle de couleurs, l’icône ou d’autres détails de la fenêtre, consultez le fichier *Manifest. JSON* dans le répertoire *wwwroot* du projet.</span><span class="sxs-lookup"><span data-stu-id="5d289-133">To customize the window's title, color scheme, icon, or other details, see the *manifest.json* file in the project's *wwwroot* directory.</span></span> <span data-ttu-id="5d289-134">Le schéma de ce fichier est défini par les normes Web.</span><span class="sxs-lookup"><span data-stu-id="5d289-134">The schema of this file is defined by web standards.</span></span> <span data-ttu-id="5d289-135">Pour plus d’informations, consultez [MDN Web docs : Web App manifest](https://developer.mozilla.org/docs/Web/Manifest).</span><span class="sxs-lookup"><span data-stu-id="5d289-135">For more information, see [MDN web docs: Web App Manifest](https://developer.mozilla.org/docs/Web/Manifest).</span></span>

## <a name="offline-support"></a><span data-ttu-id="5d289-136">Prise en charge hors connexion</span><span class="sxs-lookup"><span data-stu-id="5d289-136">Offline support</span></span>

<span data-ttu-id="5d289-137">Par défaut, les applications créées à l’aide de l’option de modèle PWA prennent en charge l’exécution hors connexion.</span><span class="sxs-lookup"><span data-stu-id="5d289-137">By default, apps created using the PWA template option have support for running offline.</span></span> <span data-ttu-id="5d289-138">Un utilisateur doit d’abord accéder à l’application pendant qu’elle est en ligne.</span><span class="sxs-lookup"><span data-stu-id="5d289-138">A user must first visit the app while they're online.</span></span> <span data-ttu-id="5d289-139">Le navigateur télécharge et met en cache automatiquement toutes les ressources nécessaires pour travailler hors connexion.</span><span class="sxs-lookup"><span data-stu-id="5d289-139">The browser automatically downloads and caches all of the resources required to operate offline.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="5d289-140">Le support de développement interfère avec le cycle de développement habituel qui consiste à apporter des modifications et à les tester.</span><span class="sxs-lookup"><span data-stu-id="5d289-140">Development support would interfere with the usual development cycle of making changes and testing them.</span></span> <span data-ttu-id="5d289-141">Par conséquent, la prise en charge hors connexion est activée uniquement pour les applications *publiées* .</span><span class="sxs-lookup"><span data-stu-id="5d289-141">Therefore, offline support is only enabled for *published* apps.</span></span> 

> [!WARNING]
> <span data-ttu-id="5d289-142">Si vous envisagez de distribuer un PWA avec accès hors connexion, il y a [plusieurs avertissements et avertissements importants](#caveats-for-offline-pwas).</span><span class="sxs-lookup"><span data-stu-id="5d289-142">If you intend to distribute an offline-enabled PWA, there are [several important warnings and caveats](#caveats-for-offline-pwas).</span></span> <span data-ttu-id="5d289-143">Ces scénarios sont inhérents aux PWA hors connexion et ne sont pas spécifiques à Blazor.</span><span class="sxs-lookup"><span data-stu-id="5d289-143">These scenarios are inherent to offline PWAs and not specific to Blazor.</span></span> <span data-ttu-id="5d289-144">Veillez à lire et à comprendre ces avertissements avant de faire des hypothèses sur le fonctionnement de votre application en mode hors connexion.</span><span class="sxs-lookup"><span data-stu-id="5d289-144">Be sure to read and understand these caveats before making assumptions about how your offline-enabled app will work.</span></span>

<span data-ttu-id="5d289-145">Pour voir comment fonctionne la prise en charge hors connexion :</span><span class="sxs-lookup"><span data-stu-id="5d289-145">To see how offline support works:</span></span>

1. <span data-ttu-id="5d289-146">Publiez l’application.</span><span class="sxs-lookup"><span data-stu-id="5d289-146">Publish the app.</span></span> <span data-ttu-id="5d289-147">Pour plus d’informations, consultez <xref:host-and-deploy/blazor/index#publish-the-app>.</span><span class="sxs-lookup"><span data-stu-id="5d289-147">For more information, see <xref:host-and-deploy/blazor/index#publish-the-app>.</span></span>
1. <span data-ttu-id="5d289-148">Déployez l’application sur un serveur qui prend en charge le protocole HTTPs, et accédez à l’application dans un navigateur à son adresse HTTPs sécurisée.</span><span class="sxs-lookup"><span data-stu-id="5d289-148">Deploy the app to a server that supports HTTPS, and access the app in a browser at its secure HTTPS address.</span></span>
1. <span data-ttu-id="5d289-149">Ouvrez les outils de développement du navigateur, puis vérifiez qu’un *Worker service* est inscrit pour l’ordinateur hôte sous l’onglet **application** :</span><span class="sxs-lookup"><span data-stu-id="5d289-149">Open the browser's dev tools and verify that a *Service Worker* is registered for the host on the **Application** tab:</span></span>

   ![L’onglet « application » des outils de développement Google Chrome montre un Worker service activé et en cours d’exécution.](progressive-web-app/_static/image4.png)

1. <span data-ttu-id="5d289-151">Rechargez la page et examinez l’onglet **réseau** . le **Service Worker** ou **cache mémoire** est répertorié comme source pour toutes les ressources de la page :</span><span class="sxs-lookup"><span data-stu-id="5d289-151">Reload the page and examine the **Network** tab. **Service Worker** or **memory cache** are listed as the sources for all of the page's assets:</span></span>

   ![L’onglet « Réseau » des outils de développement Google Chrome présente des sources pour toutes les ressources de la page.](progressive-web-app/_static/image5.png)

1. <span data-ttu-id="5d289-153">Pour vérifier que le navigateur n’est pas dépendant de l’accès réseau pour charger l’application, vous pouvez :</span><span class="sxs-lookup"><span data-stu-id="5d289-153">To verify that the browser isn't dependent on network access to load the app, either:</span></span>

   * <span data-ttu-id="5d289-154">Arrêtez le serveur Web et observez comment l’application continue de fonctionner normalement, ce qui comprend les rechargements de pages.</span><span class="sxs-lookup"><span data-stu-id="5d289-154">Shut down the web server and see how the app continues to function normally, which includes page reloads.</span></span> <span data-ttu-id="5d289-155">De même, l’application continue de fonctionner normalement lorsqu’il y a une connexion réseau lente.</span><span class="sxs-lookup"><span data-stu-id="5d289-155">Likewise, the app continues to function normally when there's a slow network connection.</span></span>
   * <span data-ttu-id="5d289-156">Demandez au navigateur de simuler le mode hors connexion dans l’onglet **réseau** :</span><span class="sxs-lookup"><span data-stu-id="5d289-156">Instruct the browser to simulate offline mode in the **Network** tab:</span></span>

   ![L’onglet « Réseau » des outils de développement Google Chrome avec la liste déroulante mode navigateur passe de « en ligne » à « hors connexion ».](progressive-web-app/_static/image6.png)

<span data-ttu-id="5d289-158">La prise en charge hors connexion à l’aide d’un Worker service est une norme Web, non spécifique à Blazor.</span><span class="sxs-lookup"><span data-stu-id="5d289-158">Offline support using a service worker is a web standard, not specific to Blazor.</span></span> <span data-ttu-id="5d289-159">Pour plus d’informations sur les Workers de service, consultez [MDN Web docs : Service Worker API](https://developer.mozilla.org/docs/Web/API/Service_Worker_API).</span><span class="sxs-lookup"><span data-stu-id="5d289-159">For more information on service workers, see [MDN web docs: Service Worker API](https://developer.mozilla.org/docs/Web/API/Service_Worker_API).</span></span> <span data-ttu-id="5d289-160">Pour en savoir plus sur les modèles d’utilisation courants pour les Workers de service, consultez [Google Web : the Service Worker Lifecycle](https://developers.google.com/web/fundamentals/primers/service-workers/lifecycle).</span><span class="sxs-lookup"><span data-stu-id="5d289-160">To learn more about common usage patterns for service workers, see [Google Web: The Service Worker Lifecycle](https://developers.google.com/web/fundamentals/primers/service-workers/lifecycle).</span></span>

<span data-ttu-id="5d289-161">le modèle PWA de Blazorproduit deux fichiers de travail de service :</span><span class="sxs-lookup"><span data-stu-id="5d289-161">Blazor's PWA template produces two service worker files:</span></span>

* <span data-ttu-id="5d289-162">*wwwroot/Service-Worker. js*, qui est utilisé pendant le développement.</span><span class="sxs-lookup"><span data-stu-id="5d289-162">*wwwroot/service-worker.js*, which is used during development.</span></span>
* <span data-ttu-id="5d289-163">*wwwroot/Service-Worker. published. js*, qui est utilisé après la publication de l’application.</span><span class="sxs-lookup"><span data-stu-id="5d289-163">*wwwroot/service-worker.published.js*, which is used after the app is published.</span></span>

<span data-ttu-id="5d289-164">Pour partager la logique entre les deux fichiers de travail de service, envisagez l’approche suivante :</span><span class="sxs-lookup"><span data-stu-id="5d289-164">To share logic between the two service worker files, consider the following approach:</span></span>

* <span data-ttu-id="5d289-165">Ajoutez un troisième fichier JavaScript pour contenir la logique commune.</span><span class="sxs-lookup"><span data-stu-id="5d289-165">Add a third JavaScript file to hold the common logic.</span></span>
* <span data-ttu-id="5d289-166">Utilisez [self. importScripts](https://developer.mozilla.org/docs/Web/API/WorkerGlobalScope/importScripts) pour charger la logique commune dans les deux fichiers de travail de service.</span><span class="sxs-lookup"><span data-stu-id="5d289-166">Use [self.importScripts](https://developer.mozilla.org/docs/Web/API/WorkerGlobalScope/importScripts) to load the common logic into both service worker files.</span></span>

### <a name="cache-first-fetch-strategy"></a><span data-ttu-id="5d289-167">Stratégie d’extraction du cache en premier</span><span class="sxs-lookup"><span data-stu-id="5d289-167">Cache-first fetch strategy</span></span>

<span data-ttu-id="5d289-168">Le service Worker *Service-Worker. published. js* intégré résout les demandes à l’aide d’une stratégie de *cache-première* .</span><span class="sxs-lookup"><span data-stu-id="5d289-168">The built-in *service-worker.published.js* service worker resolves requests using a *cache-first* strategy.</span></span> <span data-ttu-id="5d289-169">Cela signifie que le processus de travail préfère retourner le contenu mis en cache, que l’utilisateur dispose d’un accès réseau ou que du contenu plus récent soit disponible sur le serveur.</span><span class="sxs-lookup"><span data-stu-id="5d289-169">This means that the service worker prefers to return cached content, regardless of whether the user has network access or newer content is available on the server.</span></span>

<span data-ttu-id="5d289-170">La stratégie du cache en premier est utile pour les raisons suivantes :</span><span class="sxs-lookup"><span data-stu-id="5d289-170">The cache-first strategy is valuable because:</span></span>

* <span data-ttu-id="5d289-171">**Cela garantit la fiabilité.**</span><span class="sxs-lookup"><span data-stu-id="5d289-171">**It ensures reliability.**</span></span> <span data-ttu-id="5d289-172">&ndash; accès réseau n’est pas un état booléen.</span><span class="sxs-lookup"><span data-stu-id="5d289-172">&ndash; Network access isn't a boolean state.</span></span> <span data-ttu-id="5d289-173">Un utilisateur n’est pas simplement en ligne ou hors connexion :</span><span class="sxs-lookup"><span data-stu-id="5d289-173">A user isn't simply online or offline:</span></span>

  * <span data-ttu-id="5d289-174">L’appareil de l’utilisateur peut supposer qu’il est en ligne, mais il est possible que le réseau soit si lent, car il est difficile à attendre.</span><span class="sxs-lookup"><span data-stu-id="5d289-174">The user's device may assume it's online, but the network might be so slow as to be impractical to wait for.</span></span>
  * <span data-ttu-id="5d289-175">le réseau peut renvoyer des résultats non valides pour certaines URL, par exemple lorsqu’il existe un portail WIFI captif qui bloque ou redirige actuellement certaines demandes.</span><span class="sxs-lookup"><span data-stu-id="5d289-175">he network might return invalid results for certain URLs, such as when there's a captive WIFI portal that's currently blocking or redirecting certain requests.</span></span>
  
  <span data-ttu-id="5d289-176">C’est la raison pour laquelle l’API `navigator.onLine` du navigateur n’est pas fiable et ne doit pas être dépendante.</span><span class="sxs-lookup"><span data-stu-id="5d289-176">This is why the browser's `navigator.onLine` API isn't reliable and shouldn't be depended upon.</span></span>

* <span data-ttu-id="5d289-177">**Cela garantit l’exactitude.**</span><span class="sxs-lookup"><span data-stu-id="5d289-177">**It ensures correctness.**</span></span> <span data-ttu-id="5d289-178">&ndash; lors de la création d’un cache de ressources hors connexion, le service worker utilise le hachage de contenu pour garantir qu’il a extrait un instantané complet et auto-cohérent des ressources en un seul instant.</span><span class="sxs-lookup"><span data-stu-id="5d289-178">&ndash; When building a cache of offline resources, the service worker uses content hashing to guarantee it has fetched a complete and self-consistent snapshot of resources at a single instant in time.</span></span> <span data-ttu-id="5d289-179">Ce cache est ensuite utilisé comme une unité atomique.</span><span class="sxs-lookup"><span data-stu-id="5d289-179">This cache is then used as an atomic unit.</span></span> <span data-ttu-id="5d289-180">Il n’y a aucun point à demander au réseau des ressources plus récentes, puisque les seules versions requises sont celles déjà mises en cache.</span><span class="sxs-lookup"><span data-stu-id="5d289-180">There's no point asking the network for newer resources, since the only versions required are the ones already cached.</span></span> <span data-ttu-id="5d289-181">Tout autre risque d’incohérence et d’incompatibilité (par exemple, essayer d’utiliser des versions d’assemblys .NET qui n’ont pas été compilées ensemble).</span><span class="sxs-lookup"><span data-stu-id="5d289-181">Anything else risks inconsistency and incompatibility (for example, trying to use versions of .NET assemblies that weren't compiled together).</span></span>

### <a name="background-updates"></a><span data-ttu-id="5d289-182">Mises à jour en arrière-plan</span><span class="sxs-lookup"><span data-stu-id="5d289-182">Background updates</span></span>

<span data-ttu-id="5d289-183">En tant que modèle mental, vous pouvez considérer qu’un PWA en mode hors connexion se comporte comme une application mobile qui peut être installée.</span><span class="sxs-lookup"><span data-stu-id="5d289-183">As a mental model, you can think of an offline-first PWA as behaving like a mobile app that can be installed.</span></span> <span data-ttu-id="5d289-184">L’application démarre immédiatement, quelle que soit la connectivité réseau, mais la logique de l’application installée provient d’un instantané à un moment donné qui peut ne pas être la dernière version.</span><span class="sxs-lookup"><span data-stu-id="5d289-184">The app starts up immediately regardless of network connectivity, but the installed app logic comes from a point-in-time snapshot that might not be the latest version.</span></span>

<span data-ttu-id="5d289-185">Le modèle Blazor PWA produit des applications qui essaient automatiquement de se mettre à jour en arrière-plan chaque fois que l’utilisateur accède à une connexion réseau opérationnelle.</span><span class="sxs-lookup"><span data-stu-id="5d289-185">The Blazor PWA template produces apps that automatically try to update themselves in the background whenever the user visits and has a working network connection.</span></span> <span data-ttu-id="5d289-186">Ce fonctionnement est le suivant :</span><span class="sxs-lookup"><span data-stu-id="5d289-186">The way this works is as follows:</span></span>

* <span data-ttu-id="5d289-187">Au cours de la compilation, le projet génère un *manifeste des ressources de traitement de service*.</span><span class="sxs-lookup"><span data-stu-id="5d289-187">During compilation, the project generates a *service worker assets manifest*.</span></span> <span data-ttu-id="5d289-188">Par défaut, il s’agit de *Service-Worker-Assets. js*.</span><span class="sxs-lookup"><span data-stu-id="5d289-188">By default, this is called *service-worker-assets.js*.</span></span> <span data-ttu-id="5d289-189">Le manifeste répertorie toutes les ressources statiques dont l’application a besoin pour fonctionner hors connexion, telles que les assemblys .NET, les fichiers JavaScript et CSS, y compris leurs hachages de contenu.</span><span class="sxs-lookup"><span data-stu-id="5d289-189">The manifest lists all the static resources that the app requires to function offline, such as .NET assemblies, JavaScript files, and CSS, including their content hashes.</span></span> <span data-ttu-id="5d289-190">La liste des ressources est chargée par le processus de travail du service afin qu’il sache quelles ressources mettre en cache.</span><span class="sxs-lookup"><span data-stu-id="5d289-190">The resource list is loaded by the service worker so that it knows which resources to cache.</span></span>
* <span data-ttu-id="5d289-191">Chaque fois que l’utilisateur visite l’application, le navigateur redemande *Service-Worker. js* et *Service-Worker-Assets. js* en arrière-plan.</span><span class="sxs-lookup"><span data-stu-id="5d289-191">Each time the user visits the app, the browser re-requests *service-worker.js* and *service-worker-assets.js* in the background.</span></span> <span data-ttu-id="5d289-192">Les fichiers sont comparés octet par octet avec le processus de travail de service installé existant.</span><span class="sxs-lookup"><span data-stu-id="5d289-192">The files are compared byte-for-byte with the existing installed service worker.</span></span> <span data-ttu-id="5d289-193">Si le serveur retourne le contenu modifié de l’un de ces fichiers, le processus de travail de service tente d’installer une nouvelle version de lui-même.</span><span class="sxs-lookup"><span data-stu-id="5d289-193">If the server returns changed content for either of these files, the service worker attempts to install a new version of itself.</span></span>
* <span data-ttu-id="5d289-194">Lors de l’installation d’une nouvelle version de lui-même, le processus de travail crée un cache distinct pour les ressources hors connexion et démarre le remplissage du cache avec les ressources listées dans *Service-Worker-Assets. js*.</span><span class="sxs-lookup"><span data-stu-id="5d289-194">When installing a new version of itself, the service worker creates a new, separate cache for offline resources and starts populating the cache with resources listed in *service-worker-assets.js*.</span></span> <span data-ttu-id="5d289-195">Cette logique est implémentée dans la fonction `onInstall` à l’intérieur de *Service-Worker. published. js*.</span><span class="sxs-lookup"><span data-stu-id="5d289-195">This logic is implemented in the `onInstall` function inside *service-worker.published.js*.</span></span>
* <span data-ttu-id="5d289-196">Le processus se termine correctement lorsque toutes les ressources sont chargées sans erreur et que tous les hachages de contenu correspondent.</span><span class="sxs-lookup"><span data-stu-id="5d289-196">The process completes successfully when all of the resources are loaded without error and all content hashes match.</span></span> <span data-ttu-id="5d289-197">En cas de réussite, le nouveau service Worker entre dans un état *d’activation en attente* .</span><span class="sxs-lookup"><span data-stu-id="5d289-197">If successful, the new service worker enters a *waiting for activation* state.</span></span> <span data-ttu-id="5d289-198">Dès que l’utilisateur ferme l’application (pas d’onglets ou de fenêtres d’application restants), le nouveau Worker service devient *actif* et est utilisé pour les visites de l’application suivante.</span><span class="sxs-lookup"><span data-stu-id="5d289-198">As soon as the user closes the app (no remaining app tabs or windows), the new service worker becomes *active* and is used for subsequent app visits.</span></span> <span data-ttu-id="5d289-199">L’ancien service Worker et son cache sont supprimés.</span><span class="sxs-lookup"><span data-stu-id="5d289-199">The old service worker and its cache are deleted.</span></span>
* <span data-ttu-id="5d289-200">Si le processus ne se termine pas correctement, la nouvelle instance de service worker est ignorée.</span><span class="sxs-lookup"><span data-stu-id="5d289-200">If the process doesn't complete successfully, the new service worker instance is discarded.</span></span> <span data-ttu-id="5d289-201">Le processus de mise à jour est tenté à nouveau à la prochaine visite de l’utilisateur, lorsque j’espère que le client dispose d’une meilleure connexion réseau capable d’effectuer les requêtes.</span><span class="sxs-lookup"><span data-stu-id="5d289-201">The update process is attempted again on the user's next visit, when hopefully the client has a better network connection that can complete the requests.</span></span>

<span data-ttu-id="5d289-202">Personnalisez ce processus en modifiant la logique du service Worker.</span><span class="sxs-lookup"><span data-stu-id="5d289-202">Customize this process by editing the service worker logic.</span></span> <span data-ttu-id="5d289-203">Aucun des comportements précédents n’est propre à Blazor, mais il s’agit simplement de l’expérience par défaut fournie par l’option de modèle PWA.</span><span class="sxs-lookup"><span data-stu-id="5d289-203">None of the preceding behavior is specific to Blazor but is merely the default experience provided by the PWA template option.</span></span> <span data-ttu-id="5d289-204">Pour plus d’informations, consultez [MDN Web docs : Service Worker API](https://developer.mozilla.org/docs/Web/API/Service_Worker_API).</span><span class="sxs-lookup"><span data-stu-id="5d289-204">For more information, see [MDN web docs: Service Worker API](https://developer.mozilla.org/docs/Web/API/Service_Worker_API).</span></span>

### <a name="how-requests-are-resolved"></a><span data-ttu-id="5d289-205">Résolution des demandes</span><span class="sxs-lookup"><span data-stu-id="5d289-205">How requests are resolved</span></span>

<span data-ttu-id="5d289-206">Comme décrit dans la section [stratégie de récupération du cache en premier](#cache-first-fetch-strategy) , le Worker de service par défaut utilise une stratégie de cache en *premier* , ce qui signifie qu’il tente de traiter le contenu mis en cache quand il est disponible.</span><span class="sxs-lookup"><span data-stu-id="5d289-206">As described in the [Cache-first fetch strategy](#cache-first-fetch-strategy) section, the default service worker uses a *cache-first* strategy, meaning that it tries to serve cached content when available.</span></span> <span data-ttu-id="5d289-207">S’il n’existe aucun contenu mis en cache pour une certaine URL, par exemple lors de la demande de données à partir d’une API de serveur principal, le processus de travail de service revient sur une demande réseau normale.</span><span class="sxs-lookup"><span data-stu-id="5d289-207">If there is no content cached for a certain URL, for example when requesting data from a backend API, the service worker falls back on a regular network request.</span></span> <span data-ttu-id="5d289-208">La demande réseau a abouti si le serveur est accessible.</span><span class="sxs-lookup"><span data-stu-id="5d289-208">The network request succeeds if the server is reachable.</span></span> <span data-ttu-id="5d289-209">Cette logique est implémentée dans `onFetch` fonction dans *Service-Worker. published. js*.</span><span class="sxs-lookup"><span data-stu-id="5d289-209">This logic is implemented inside `onFetch` function within *service-worker.published.js*.</span></span>

<span data-ttu-id="5d289-210">Si les composants Razor de l’application reposent sur la demande de données à partir des API backend et que vous souhaitez fournir une expérience utilisateur conviviale pour les demandes ayant échoué en raison de l’indisponibilité du réseau, implémentez la logique dans les composants de l’application.</span><span class="sxs-lookup"><span data-stu-id="5d289-210">If the app's Razor components rely on requesting data from backend APIs and you want to provide a friendly user experience for failed requests due to network unavailability, implement logic within the app's components.</span></span> <span data-ttu-id="5d289-211">Par exemple, utilisez `try/catch` autour des demandes `HttpClient`.</span><span class="sxs-lookup"><span data-stu-id="5d289-211">For example, use `try/catch` around `HttpClient` requests.</span></span>

### <a name="support-server-rendered-pages"></a><span data-ttu-id="5d289-212">Prendre en charge les pages rendues par le serveur</span><span class="sxs-lookup"><span data-stu-id="5d289-212">Support server-rendered pages</span></span>

<span data-ttu-id="5d289-213">Réfléchissez à ce qui se passe quand l’utilisateur accède pour la première fois à une URL telle que `/counter` ou tout autre lien profond dans l’application.</span><span class="sxs-lookup"><span data-stu-id="5d289-213">Consider what happens when the user first navigates to a URL such as `/counter` or any other deep link in the app.</span></span> <span data-ttu-id="5d289-214">Dans ce cas, vous ne souhaitez pas renvoyer le contenu mis en cache en tant que `/counter`, mais vous avez besoin du navigateur pour charger le contenu mis en cache en tant que `/index.html` pour démarrer votre application Blazor webassembly.</span><span class="sxs-lookup"><span data-stu-id="5d289-214">In these cases, you don't want to return content cached as `/counter`, but instead need the browser to load the content cached as `/index.html` to start up your Blazor WebAssembly app.</span></span> <span data-ttu-id="5d289-215">Ces demandes initiales sont appelées demandes de *navigation* , par opposition à :</span><span class="sxs-lookup"><span data-stu-id="5d289-215">These initial requests are known as *navigation* requests, as opposed to:</span></span>

* <span data-ttu-id="5d289-216">demandes de sous- *ressources* pour les images, les feuilles de style ou d’autres fichiers.</span><span class="sxs-lookup"><span data-stu-id="5d289-216">*subresource* requests for images, stylesheets, or other files.</span></span>
* <span data-ttu-id="5d289-217">requêtes *Fetch/XHR* pour les données d’API.</span><span class="sxs-lookup"><span data-stu-id="5d289-217">*fetch/XHR* requests for API data.</span></span>

<span data-ttu-id="5d289-218">Le service Worker par défaut contient une logique de cas spéciale pour les demandes de navigation.</span><span class="sxs-lookup"><span data-stu-id="5d289-218">The default service worker contains special-case logic for navigation requests.</span></span> <span data-ttu-id="5d289-219">Le Worker de service résout les demandes en retournant le contenu mis en cache pour `/index.html`, quelle que soit l’URL demandée.</span><span class="sxs-lookup"><span data-stu-id="5d289-219">The service worker resolves the requests by returning the cached content for `/index.html`, regardless of the requested URL.</span></span> <span data-ttu-id="5d289-220">Cette logique est implémentée dans la fonction `onFetch` à l’intérieur de *Service-Worker. published. js*.</span><span class="sxs-lookup"><span data-stu-id="5d289-220">This logic is implemented in the `onFetch` function inside *service-worker.published.js*.</span></span>

<span data-ttu-id="5d289-221">Si votre application comporte certaines URL qui doivent retourner du code HTML rendu serveur et ne servent pas `/index.html` du cache, vous devez modifier la logique de votre service Worker.</span><span class="sxs-lookup"><span data-stu-id="5d289-221">If your app has certain URLs that must return server-rendered HTML, and not serve `/index.html` from the cache, then you need to edit the logic in your service worker.</span></span> <span data-ttu-id="5d289-222">Si toutes les URL contenant des `/Identity/` doivent être gérées en tant que demandes standard en ligne uniquement au serveur, modifiez la logique de `onFetch` de *Service-Worker. published. js* .</span><span class="sxs-lookup"><span data-stu-id="5d289-222">If all URLs containing `/Identity/` need to be handled as regular online-only requests to the server, then modify *service-worker.published.js* `onFetch` logic.</span></span> <span data-ttu-id="5d289-223">Recherchez le code suivant :</span><span class="sxs-lookup"><span data-stu-id="5d289-223">Locate the following code:</span></span>

```javascript
const shouldServeIndexHtml = event.request.mode === 'navigate';
```

<span data-ttu-id="5d289-224">Remplacez le code par ce qui suit :</span><span class="sxs-lookup"><span data-stu-id="5d289-224">Change the code to the following:</span></span>

```javascript
const shouldServeIndexHtml = event.request.mode === 'navigate'
    && !event.request.url.includes('/Identity/');
```

<span data-ttu-id="5d289-225">Si vous n’effectuez pas cette opération, quelle que soit la connectivité réseau, le service Worker intercepte les demandes de ces URL et les résout à l’aide de `/index.html`.</span><span class="sxs-lookup"><span data-stu-id="5d289-225">If you don't do this, then regardless of network connectivity, the service worker intercepts requests for such URLs and resolves them using `/index.html`.</span></span>

### <a name="control-asset-caching"></a><span data-ttu-id="5d289-226">Contrôler la mise en cache des ressources</span><span class="sxs-lookup"><span data-stu-id="5d289-226">Control asset caching</span></span>

<span data-ttu-id="5d289-227">Si votre projet définit le `ServiceWorkerAssetsManifest` propriété MSBuild, les outils de génération de Blazorgénèrent un manifeste des ressources de traitement de service avec le nom spécifié.</span><span class="sxs-lookup"><span data-stu-id="5d289-227">If your project defines the `ServiceWorkerAssetsManifest` MSBuild property, Blazor's build tooling generates a service worker assets manifest with the specified name.</span></span> <span data-ttu-id="5d289-228">Le modèle PWA par défaut produit un fichier projet contenant la propriété suivante :</span><span class="sxs-lookup"><span data-stu-id="5d289-228">The default PWA template produces a project file containing the following property:</span></span>

```xml
<ServiceWorkerAssetsManifest>service-worker-assets.js</ServiceWorkerAssetsManifest>
```

<span data-ttu-id="5d289-229">Le fichier est placé dans le répertoire de sortie *wwwroot* , de sorte que le navigateur peut récupérer ce fichier en demandant `/service-worker-assets.js`.</span><span class="sxs-lookup"><span data-stu-id="5d289-229">The file is placed in the *wwwroot* output directory, so the browser can retrieve this file by requesting `/service-worker-assets.js`.</span></span> <span data-ttu-id="5d289-230">Pour afficher le contenu de ce fichier, ouvrez */bin/debug/{Target Framework}/wwwroot/Service-Worker-Assets.js* dans un éditeur de texte.</span><span class="sxs-lookup"><span data-stu-id="5d289-230">To see the contents of this file, open */bin/Debug/{TARGET FRAMEWORK}/wwwroot/service-worker-assets.js* in a text editor.</span></span> <span data-ttu-id="5d289-231">Toutefois, ne modifiez pas le fichier, car il est régénéré à chaque Build.</span><span class="sxs-lookup"><span data-stu-id="5d289-231">However, don't edit the file, as it's regenerated on each build.</span></span>

<span data-ttu-id="5d289-232">Par défaut, ce manifeste répertorie les éléments suivants :</span><span class="sxs-lookup"><span data-stu-id="5d289-232">By default, this manifest lists:</span></span>

* <span data-ttu-id="5d289-233">Toutes les ressources gérées par Blazor, telles que les assemblys .NET et les fichiers d’exécution webassembly .NET nécessaires pour fonctionner hors connexion.</span><span class="sxs-lookup"><span data-stu-id="5d289-233">Any Blazor-managed resources, such as .NET assemblies and the .NET WebAssembly runtime files required to function offline.</span></span>
* <span data-ttu-id="5d289-234">Toutes les ressources pour la publication dans le répertoire *wwwroot* de l’application, telles que les images, les feuilles de style et les fichiers JavaScript, y compris les ressources Web statiques fournies par les projets externes et les packages NuGet.</span><span class="sxs-lookup"><span data-stu-id="5d289-234">All resources for publishing to the app's *wwwroot* directory, such as images, stylesheets, and JavaScript files, including static web assets supplied by external projects and NuGet packages.</span></span>

<span data-ttu-id="5d289-235">Vous pouvez contrôler les ressources qui sont extraites et mises en cache par le service Worker en modifiant la logique dans `onInstall` dans *Service-Worker. published. js*.</span><span class="sxs-lookup"><span data-stu-id="5d289-235">You can control which of these resources are fetched and cached by the service worker by editing the logic in `onInstall` in *service-worker.published.js*.</span></span> <span data-ttu-id="5d289-236">Par défaut, le processus de travail récupère et met en cache les fichiers correspondant à des extensions de nom de fichier Web typiques, telles que *. html*, *. CSS*, *. js*et *. WASM*, ainsi que des types de fichiers spécifiques à Blazor webassembly ( *. dll*, *. pdb*).</span><span class="sxs-lookup"><span data-stu-id="5d289-236">By default, the service worker fetches and caches files matching typical web filename extensions such as *.html*, *.css*, *.js*, and *.wasm*, plus file types specific to Blazor WebAssembly (*.dll*, *.pdb*).</span></span>

<span data-ttu-id="5d289-237">Pour inclure des ressources supplémentaires qui ne sont pas présentes dans le répertoire *wwwroot* de l’application, définissez des entrées `ItemGroup` MSBuild supplémentaires, comme indiqué dans l’exemple suivant :</span><span class="sxs-lookup"><span data-stu-id="5d289-237">To include additional resources that aren't present in the app's *wwwroot* directory, define extra MSBuild `ItemGroup` entries, as shown in the following example:</span></span>

```xml
<ItemGroup>
  <ServiceWorkerAssetsManifestItem Include="MyDirectory\AnotherFile.json"
    RelativePath="MyDirectory\AnotherFile.json" AssetUrl="files/AnotherFile.json" />
</ItemGroup>
```

<span data-ttu-id="5d289-238">Les métadonnées de `AssetUrl` spécifient l’URL relative de base que le navigateur doit utiliser lors de la récupération de la ressource à mettre en cache.</span><span class="sxs-lookup"><span data-stu-id="5d289-238">The `AssetUrl` metadata specifies the base-relative URL that the browser should use when fetching the resource to cache.</span></span> <span data-ttu-id="5d289-239">Cela peut être indépendant du nom du fichier source d’origine sur le disque.</span><span class="sxs-lookup"><span data-stu-id="5d289-239">This can be independent of its original source file name on disk.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="5d289-240">L’ajout d’un `ServiceWorkerAssetsManifestItem` n’entraîne pas la publication du fichier dans le répertoire *wwwroot* de l’application.</span><span class="sxs-lookup"><span data-stu-id="5d289-240">Adding a `ServiceWorkerAssetsManifestItem` doesn't cause the file to be published in the app's *wwwroot* directory.</span></span> <span data-ttu-id="5d289-241">La sortie de publication doit être contrôlée séparément.</span><span class="sxs-lookup"><span data-stu-id="5d289-241">The publish output must be controlled separately.</span></span> <span data-ttu-id="5d289-242">Le `ServiceWorkerAssetsManifestItem` entraîne uniquement l’apparition d’une entrée supplémentaire dans le manifeste des ressources du Worker.</span><span class="sxs-lookup"><span data-stu-id="5d289-242">The `ServiceWorkerAssetsManifestItem` only causes an additional entry to appear in the service worker assets manifest.</span></span>

## <a name="push-notifications"></a><span data-ttu-id="5d289-243">Notifications Push</span><span class="sxs-lookup"><span data-stu-id="5d289-243">Push notifications</span></span>

<span data-ttu-id="5d289-244">Comme tout autre PWA, un Blazor webassembly PWA peut recevoir des notifications push à partir d’un serveur principal.</span><span class="sxs-lookup"><span data-stu-id="5d289-244">Like any other PWA, a Blazor WebAssembly PWA can receive push notifications from a backend server.</span></span> <span data-ttu-id="5d289-245">Le serveur peut envoyer des notifications push à tout moment, même lorsque l’utilisateur n’utilise pas activement l’application.</span><span class="sxs-lookup"><span data-stu-id="5d289-245">The server can send push notifications at any time, even when the user isn't actively using the app.</span></span> <span data-ttu-id="5d289-246">Par exemple, les notifications push peuvent être envoyées lorsqu’un autre utilisateur effectue une action appropriée.</span><span class="sxs-lookup"><span data-stu-id="5d289-246">For example, push notifications can be sent when a different user performs a relevant action.</span></span>

<span data-ttu-id="5d289-247">Le mécanisme d’envoi d’une notification push est entièrement indépendant de Blazor webassembly, car il est implémenté par le serveur principal qui peut utiliser n’importe quelle technologie.</span><span class="sxs-lookup"><span data-stu-id="5d289-247">The mechanism for sending a push notification is entirely independent of Blazor WebAssembly, since it's implemented by the backend server which can use any technology.</span></span> <span data-ttu-id="5d289-248">Si vous souhaitez envoyer des notifications push à partir d’un serveur de ASP.NET Core, envisagez d' [utiliser une technique similaire à l’approche adoptée dans l’atelier de pizzas éblouissant](https://github.com/dotnet-presentations/blazor-workshop/blob/master/docs/09-progressive-web-app.md#sending-push-notifications).</span><span class="sxs-lookup"><span data-stu-id="5d289-248">If you want to send push notifications from an ASP.NET Core server, consider [using a technique similar to the approach taken in the Blazing Pizza workshop](https://github.com/dotnet-presentations/blazor-workshop/blob/master/docs/09-progressive-web-app.md#sending-push-notifications).</span></span>

<span data-ttu-id="5d289-249">Le mécanisme de réception et d’affichage d’une notification push sur le client est également indépendant de Blazor webassembly, puisqu’il est implémenté dans le fichier JavaScript Service Worker.</span><span class="sxs-lookup"><span data-stu-id="5d289-249">The mechanism for receiving and displaying a push notification on the client is also independent of Blazor WebAssembly, since it's implemented in the service worker JavaScript file.</span></span> <span data-ttu-id="5d289-250">Pour obtenir un exemple, consultez [l’approche utilisée dans l’atelier de pizzas éblouissant](https://github.com/dotnet-presentations/blazor-workshop/blob/master/docs/09-progressive-web-app.md#displaying-notifications).</span><span class="sxs-lookup"><span data-stu-id="5d289-250">For an example, see [the approach used in the Blazing Pizza workshop](https://github.com/dotnet-presentations/blazor-workshop/blob/master/docs/09-progressive-web-app.md#displaying-notifications).</span></span>

## <a name="caveats-for-offline-pwas"></a><span data-ttu-id="5d289-251">Avertissements pour les PWA hors connexion</span><span class="sxs-lookup"><span data-stu-id="5d289-251">Caveats for offline PWAs</span></span>

<span data-ttu-id="5d289-252">Toutes les applications ne doivent pas essayer de prendre en charge l’utilisation hors connexion.</span><span class="sxs-lookup"><span data-stu-id="5d289-252">Not all apps should attempt to support offline use.</span></span> <span data-ttu-id="5d289-253">La prise en charge hors connexion ajoute une complexité significative, mais n’est pas toujours pertinente pour les cas d’usage requis.</span><span class="sxs-lookup"><span data-stu-id="5d289-253">Offline support adds significant complexity, while not always being relevant for the use cases required.</span></span>

<span data-ttu-id="5d289-254">La prise en charge hors connexion est généralement pertinente uniquement :</span><span class="sxs-lookup"><span data-stu-id="5d289-254">Offline support is usually relevant only:</span></span>

* <span data-ttu-id="5d289-255">Si la Banque de données principale est locale pour le navigateur.</span><span class="sxs-lookup"><span data-stu-id="5d289-255">If the primary data store is local to the browser.</span></span> <span data-ttu-id="5d289-256">Par exemple, l’approche est pertinente dans une application avec une interface utilisateur pour un appareil [IOT](https://en.wikipedia.org/wiki/Internet_of_things) qui stocke des données dans `localStorage` ou [IndexedDB](https://developer.mozilla.org/docs/Web/API/IndexedDB_API).</span><span class="sxs-lookup"><span data-stu-id="5d289-256">For example, the approach is relevant in an app with a UI for an [IoT](https://en.wikipedia.org/wiki/Internet_of_things) device that stores data in `localStorage` or [IndexedDB](https://developer.mozilla.org/docs/Web/API/IndexedDB_API).</span></span>
* <span data-ttu-id="5d289-257">Si l’application effectue une quantité importante de travail pour extraire et mettre en cache les données de l’API backend pertinentes pour chaque utilisateur afin qu’elles puissent parcourir les données hors connexion.</span><span class="sxs-lookup"><span data-stu-id="5d289-257">If the app performs a significant amount of work to fetch and cache the backend API data relevant to each user so that they can navigate through the data offline.</span></span> <span data-ttu-id="5d289-258">Si l’application doit prendre en charge la modification, un système de suivi des modifications et de synchronisation des données avec le serveur principal doit être généré.</span><span class="sxs-lookup"><span data-stu-id="5d289-258">If the app must support editing, a system for tracking changes and synchronizing data with the backend must be built.</span></span>
* <span data-ttu-id="5d289-259">Si l’objectif est de garantir que l’application se charge immédiatement, indépendamment des conditions du réseau.</span><span class="sxs-lookup"><span data-stu-id="5d289-259">If the goal is to guarantee that the app loads immediately regardless of network conditions.</span></span> <span data-ttu-id="5d289-260">Implémentez une expérience utilisateur appropriée autour des demandes d’API backend pour montrer la progression des requêtes et se comporter correctement lorsque les requêtes échouent en raison d’une indisponibilité du réseau.</span><span class="sxs-lookup"><span data-stu-id="5d289-260">Implement a suitable user experience around backend API requests to show the progress of requests and behave gracefully when requests fail due to network unavailability.</span></span>

<span data-ttu-id="5d289-261">En outre, les PWAS en mode hors connexion doivent gérer un éventail de complications supplémentaires.</span><span class="sxs-lookup"><span data-stu-id="5d289-261">Additionally, offline-capable PWAs must deal with a range of additional complications.</span></span> <span data-ttu-id="5d289-262">Les développeurs doivent se familiariser avec les limitations des sections suivantes.</span><span class="sxs-lookup"><span data-stu-id="5d289-262">Developers should carefully familiarize themselves with the caveats in the following sections.</span></span>

### <a name="offline-support-only-when-published"></a><span data-ttu-id="5d289-263">Prise en charge hors connexion uniquement lors de la publication</span><span class="sxs-lookup"><span data-stu-id="5d289-263">Offline support only when published</span></span>

<span data-ttu-id="5d289-264">Pendant le développement, vous souhaitez généralement voir chaque modification reflétée immédiatement dans le navigateur sans passer par un processus de mise à jour en arrière-plan.</span><span class="sxs-lookup"><span data-stu-id="5d289-264">During development you typically want to see each change reflected immediately in the browser without going through a background update process.</span></span> <span data-ttu-id="5d289-265">Par conséquent, le modèle PWA de Blazorn’autorise la prise en charge hors connexion que lorsqu’il est publié.</span><span class="sxs-lookup"><span data-stu-id="5d289-265">Therefore, Blazor's PWA template enables offline support only when published.</span></span>

<span data-ttu-id="5d289-266">Lors de la création d’une application de compatibilité hors connexion, il n’est pas suffisant de tester l’application dans l’environnement de développement.</span><span class="sxs-lookup"><span data-stu-id="5d289-266">When building an offline-capable app, it's not enough to test the app in the Development environment.</span></span> <span data-ttu-id="5d289-267">Vous devez tester l’application dans son état publié pour comprendre comment elle répond à différentes conditions réseau.</span><span class="sxs-lookup"><span data-stu-id="5d289-267">You must test the app in its published state to understand how it responds to different network conditions.</span></span>

### <a name="update-completion-after-user-navigation-away-from-app"></a><span data-ttu-id="5d289-268">Mettre à jour l’achèvement après la navigation de l’utilisateur hors de l’application</span><span class="sxs-lookup"><span data-stu-id="5d289-268">Update completion after user navigation away from app</span></span>

<span data-ttu-id="5d289-269">Les mises à jour ne se terminent pas tant que l’utilisateur n’a pas quitté l’application dans tous les onglets.</span><span class="sxs-lookup"><span data-stu-id="5d289-269">Updates don't complete until the user has navigated away from the app in all tabs.</span></span> <span data-ttu-id="5d289-270">Comme expliqué dans la section [mises à jour en arrière-plan](#background-updates) , après le déploiement d’une mise à jour de l’application, le navigateur récupère les fichiers de travail de service mis à jour pour commencer le processus de mise à jour.</span><span class="sxs-lookup"><span data-stu-id="5d289-270">As explained in the [Background updates](#background-updates) section, after you deploy an update to the app, the browser fetches the updated service worker files to begin the update process.</span></span>

<span data-ttu-id="5d289-271">Ce que de nombreux développeurs peuvent faire, même lorsque cette mise à jour est terminée, elle n’entre pas en vigueur tant que l’utilisateur n’a **pas** quitté tous les onglets.</span><span class="sxs-lookup"><span data-stu-id="5d289-271">What surprises many developers is that, even when this update completes, it does **not** take effect until the user has navigated away in all tabs.</span></span> <span data-ttu-id="5d289-272">Il n’est **pas** suffisant d’actualiser l’onglet qui affiche l’application, même s’il s’agit du seul onglet qui affiche l’application.</span><span class="sxs-lookup"><span data-stu-id="5d289-272">It is **not** sufficient to refresh the tab displaying the app, even if it's the only tab displaying the app.</span></span> <span data-ttu-id="5d289-273">Tant que votre application n’est pas complètement fermée, le nouveau service Worker reste dans l’État en *attente d’activation* .</span><span class="sxs-lookup"><span data-stu-id="5d289-273">Until your app is completely closed, the new service worker remains in the *waiting to activate* status.</span></span> <span data-ttu-id="5d289-274">**Cela n’est pas spécifique à Blazor, mais plutôt à un comportement de plateforme Web standard.**</span><span class="sxs-lookup"><span data-stu-id="5d289-274">**This is not specific to Blazor, but rather is a standard web platform behavior.**</span></span>

<span data-ttu-id="5d289-275">Cela ne pose généralement pas de ennuis aux développeurs qui essaient de tester les mises à jour de leur service Worker ou des ressources mises en cache hors connexion.</span><span class="sxs-lookup"><span data-stu-id="5d289-275">This commonly troubles developers who are trying to test updates to their service worker or offline cached resources.</span></span> <span data-ttu-id="5d289-276">Si vous archivez dans les outils de développement du navigateur, vous pouvez voir un résultat semblable à ce qui suit :</span><span class="sxs-lookup"><span data-stu-id="5d289-276">If you check in the browser's developer tools, you may see something like the following:</span></span>

![L’onglet « application » de Google Chrome indique que le service Worker de l’application est en attente d’activation.](progressive-web-app/_static/image7.png)

<span data-ttu-id="5d289-278">Tant que la liste des « clients », qui sont des onglets ou des fenêtres affichant votre application, n’est pas vide, le processus de travail continue à attendre.</span><span class="sxs-lookup"><span data-stu-id="5d289-278">For as long as the list of "clients," which are tabs or windows displaying your app, is nonempty, the worker continues waiting.</span></span> <span data-ttu-id="5d289-279">La raison pour laquelle le service Workers effectue cette tâche est de garantir la cohérence.</span><span class="sxs-lookup"><span data-stu-id="5d289-279">The reason service workers do this is to guarantee consistency.</span></span> <span data-ttu-id="5d289-280">La cohérence signifie que toutes les ressources sont extraites du même cache atomique.</span><span class="sxs-lookup"><span data-stu-id="5d289-280">Consistency means that all resources are fetched from the same atomic cache.</span></span>

<span data-ttu-id="5d289-281">Lorsque vous testez des modifications, il peut s’avérer utile de cliquer sur le lien « skipWaiting » comme indiqué dans la capture d’écran précédente, puis de recharger la page.</span><span class="sxs-lookup"><span data-stu-id="5d289-281">When testing changes, you may find it convenient to click the "skipWaiting" link as shown in the preceding screenshot, then reload the page.</span></span> <span data-ttu-id="5d289-282">Vous pouvez automatiser cette automatisation pour tous les utilisateurs en codant votre service Workers pour [ignorer la phase « en attente » et activer immédiatement la mise à jour](https://developers.google.com/web/fundamentals/primers/service-workers/lifecycle#skip_the_waiting_phase).</span><span class="sxs-lookup"><span data-stu-id="5d289-282">You can automate this for all users by coding your service worker to [skip the "waiting" phase and immediately activate on update](https://developers.google.com/web/fundamentals/primers/service-workers/lifecycle#skip_the_waiting_phase).</span></span> <span data-ttu-id="5d289-283">Si vous ignorez la phase d’attente, vous vous soumettez à la garantie que les ressources sont toujours extraites de façon cohérente à partir de la même instance de cache.</span><span class="sxs-lookup"><span data-stu-id="5d289-283">If you skip the waiting phase, you're giving up the guarantee that resources are always fetched consistently from the same cache instance.</span></span>

### <a name="users-may-run-any-historical-version-of-the-app"></a><span data-ttu-id="5d289-284">Les utilisateurs peuvent exécuter n’importe quelle version historique de l’application</span><span class="sxs-lookup"><span data-stu-id="5d289-284">Users may run any historical version of the app</span></span>

<span data-ttu-id="5d289-285">Les développeurs Web s’attendent habituellement à ce que les utilisateurs exécutent uniquement la dernière version déployée de leur application Web, car cela est normal dans le modèle de distribution Web traditionnel.</span><span class="sxs-lookup"><span data-stu-id="5d289-285">Web developers habitually expect that users only run the latest deployed version of their web app, since that's normal within the traditional web distribution model.</span></span> <span data-ttu-id="5d289-286">Toutefois, un PWA en mode hors connexion est plus similaire à une application mobile native, où les utilisateurs n’exécutent pas nécessairement la dernière version.</span><span class="sxs-lookup"><span data-stu-id="5d289-286">However, an offline-first PWA is more akin to a native mobile app, where users aren't necessarily running the latest version.</span></span>

<span data-ttu-id="5d289-287">Comme expliqué dans la section [mises à jour en arrière-plan](#background-updates) , après le déploiement d’une mise à jour de votre application, **chaque utilisateur existant continue d’utiliser une version précédente pendant au moins une autre visite** , car la mise à jour se produit en arrière-plan et n’est pas activée tant que l’utilisateur ne l’a pas quitté par la suite.</span><span class="sxs-lookup"><span data-stu-id="5d289-287">As explained in the [Background updates](#background-updates) section, after you deploy an update to your app, **each existing user continues to use a previous version for at least one further visit** because the update occurs in the background and isn't activated until the user thereafter navigates away.</span></span> <span data-ttu-id="5d289-288">En outre, la version précédente utilisée n’est pas nécessairement la version précédente que vous avez déployée.</span><span class="sxs-lookup"><span data-stu-id="5d289-288">Plus, the previous version being used isn't necessarily the previous one you deployed.</span></span> <span data-ttu-id="5d289-289">La version précédente peut être *n’importe quelle* version historique, selon la date de la dernière exécution d’une mise à jour par l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="5d289-289">The previous version can be *any* historical version, depending on when the user last completed an update.</span></span>

<span data-ttu-id="5d289-290">Cela peut être un problème si les composants frontend et backend de votre application requièrent un accord sur le schéma pour les demandes d’API.</span><span class="sxs-lookup"><span data-stu-id="5d289-290">This can be an issue if the frontend and backend parts of your app require agreement about the schema for API requests.</span></span> <span data-ttu-id="5d289-291">Vous ne devez pas déployer des modifications de schéma d’API à compatibilité descendante tant que vous n’êtes pas certain que tous les utilisateurs ont été mis à niveau.</span><span class="sxs-lookup"><span data-stu-id="5d289-291">You must not deploy backward-incompatible API schema changes until you can be sure that all users have upgraded.</span></span> <span data-ttu-id="5d289-292">Vous pouvez également empêcher les utilisateurs d’utiliser des versions antérieures incompatibles de l’application.</span><span class="sxs-lookup"><span data-stu-id="5d289-292">Alternatively, block users from using incompatible older versions of the app.</span></span> <span data-ttu-id="5d289-293">Cette exigence de scénario est la même que pour les applications mobiles natives.</span><span class="sxs-lookup"><span data-stu-id="5d289-293">This scenario requirement is the same as for native mobile apps.</span></span> <span data-ttu-id="5d289-294">Si vous déployez une modification avec rupture dans les API de serveur, l’application cliente est interrompue pour les utilisateurs qui n’ont pas encore mis à jour.</span><span class="sxs-lookup"><span data-stu-id="5d289-294">If you deploy a breaking change in server APIs, the client app is broken for users who haven't yet updated.</span></span>

<span data-ttu-id="5d289-295">Si possible, ne déployez pas les modifications importantes apportées à vos API backend.</span><span class="sxs-lookup"><span data-stu-id="5d289-295">If possible, don't deploy breaking changes to your backend APIs.</span></span> <span data-ttu-id="5d289-296">Si vous devez le faire, envisagez d’utiliser des [API de travail de service standard, telles que ServiceWorkerRegistration](https://developer.mozilla.org/docs/Web/API/ServiceWorkerRegistration) , pour déterminer si l’application est à jour et, si ce n’est pas le cas, pour empêcher l’utilisation.</span><span class="sxs-lookup"><span data-stu-id="5d289-296">If you must do so, consider using [standard Service Worker APIs such as ServiceWorkerRegistration](https://developer.mozilla.org/docs/Web/API/ServiceWorkerRegistration) to determine whether the app is up-to-date, and if not, to prevent usage.</span></span>

### <a name="interference-with-server-rendered-pages"></a><span data-ttu-id="5d289-297">Interférence avec les pages rendues par le serveur</span><span class="sxs-lookup"><span data-stu-id="5d289-297">Interference with server-rendered pages</span></span>

<span data-ttu-id="5d289-298">Comme décrit dans la section [prise en charge des pages rendues](#support-server-rendered-pages) par le serveur, si vous souhaitez contourner le comportement du processus de travail de retour de `/index.html` contenu pour toutes les demandes de navigation, modifiez la logique de votre service Worker.</span><span class="sxs-lookup"><span data-stu-id="5d289-298">As described in the [Support server-rendered pages](#support-server-rendered-pages) section, if you want to bypass the service worker's behavior of returning `/index.html` contents for all navigation requests, edit the logic in your service worker.</span></span>

### <a name="all-service-worker-asset-manifest-contents-are-cached-by-default"></a><span data-ttu-id="5d289-299">Tous les contenus du manifeste de la ressource Service Worker sont mis en cache par défaut</span><span class="sxs-lookup"><span data-stu-id="5d289-299">All service worker asset manifest contents are cached by default</span></span>

<span data-ttu-id="5d289-300">Comme décrit dans la section [mise en cache des ressources de contrôle](#control-asset-caching) , le fichier *Service-Worker-Assets. js* est généré pendant la génération et répertorie toutes les ressources que le processus de travail de service doit extraire et mettre en cache.</span><span class="sxs-lookup"><span data-stu-id="5d289-300">As described in the [Control asset caching](#control-asset-caching) section, the file *service-worker-assets.js* is generated during build and lists all assets the service worker should fetch and cache.</span></span>

<span data-ttu-id="5d289-301">Étant donné que cette liste inclut par défaut tout ce qui est émis vers *wwwroot*, y compris le contenu fourni par des packages et des projets externes, vous devez veiller à ne pas y placer trop de contenu.</span><span class="sxs-lookup"><span data-stu-id="5d289-301">Since this list by default includes everything emitted to *wwwroot*, including content supplied by external packages and projects, you must be careful not to put too much content there.</span></span> <span data-ttu-id="5d289-302">Si le répertoire *wwwroot* contient des millions d’images, le processus de travail de service tente de les extraire et de les mettre en cache, ce qui consomme une bande passante excessive et risque de ne pas se terminer correctement.</span><span class="sxs-lookup"><span data-stu-id="5d289-302">If the *wwwroot* directory contains millions of images, the service worker tries to fetch and cache them all, consuming excessive bandwidth and most likely not completing successfully.</span></span>

<span data-ttu-id="5d289-303">Implémentez une logique arbitraire pour contrôler le sous-ensemble du contenu du manifeste qui doit être extrait et mis en cache en modifiant la fonction `onInstall` dans *Service-Worker. published. js*.</span><span class="sxs-lookup"><span data-stu-id="5d289-303">Implement arbitrary logic to control which subset of the manifest's contents should be fetched and cached by editing the `onInstall` function in *service-worker.published.js*.</span></span>

### <a name="interaction-with-authentication"></a><span data-ttu-id="5d289-304">Interaction avec l’authentification</span><span class="sxs-lookup"><span data-stu-id="5d289-304">Interaction with authentication</span></span>

<span data-ttu-id="5d289-305">Il est possible d’utiliser l’option de modèle PWA conjointement avec les options d’authentification.</span><span class="sxs-lookup"><span data-stu-id="5d289-305">It's possible to use the PWA template option in conjunction with the authentication options.</span></span> <span data-ttu-id="5d289-306">Un PWA compatible hors connexion peut également prendre en charge l’authentification lorsque l’utilisateur dispose d’une connectivité réseau.</span><span class="sxs-lookup"><span data-stu-id="5d289-306">An offline-capable PWA can also support authentication when the user has network connectivity.</span></span>

<span data-ttu-id="5d289-307">Lorsqu’un utilisateur n’a pas de connectivité réseau, il ne peut pas s’authentifier ou obtenir des jetons d’accès.</span><span class="sxs-lookup"><span data-stu-id="5d289-307">When a user doesn't have network connectivity, they can't authenticate or obtain access tokens.</span></span> <span data-ttu-id="5d289-308">Par défaut, si vous tentez d’accéder à la page de connexion sans accès réseau, le message « erreur réseau » s’affiche.</span><span class="sxs-lookup"><span data-stu-id="5d289-308">By default, attempting to visit the login page without network access results in a "network error" message.</span></span>

<span data-ttu-id="5d289-309">Vous devez concevoir un workflow d’interface utilisateur qui permet à l’utilisateur d’effectuer des opérations utiles en mode hors connexion sans tenter de s’authentifier ou d’obtenir des jetons d’accès.</span><span class="sxs-lookup"><span data-stu-id="5d289-309">You must design a UI flow that lets the user do useful things while offline without attempting to authenticate or obtain access tokens.</span></span> <span data-ttu-id="5d289-310">Vous pouvez également concevoir l’application pour qu’elle échoue de manière appropriée lorsque le réseau n’est pas disponible.</span><span class="sxs-lookup"><span data-stu-id="5d289-310">Alternatively, you can design the app to fail in a graceful way when the network isn't available.</span></span> <span data-ttu-id="5d289-311">Si ce n’est pas possible dans votre application, il se peut que vous ne souhaitiez pas activer la prise en charge hors connexion.</span><span class="sxs-lookup"><span data-stu-id="5d289-311">If this isn't possible in your app, you might not want to enable offline support.</span></span>
